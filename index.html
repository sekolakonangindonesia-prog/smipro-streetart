<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMIPRO - Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="welcome-overlay" style="display:none; position:fixed; inset:0; background:#000; z-index:9999; flex-direction:column; align-items:center; justify-content:center; text-align:center;">
    <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/main/Logo_Stretart.png" style="width:100px; margin-bottom:20px;">
    <h2 style="color:white; letter-spacing:4px; font-size:1.2rem;">SMIPRO STREET ART</h2>
    <p style="color:#555; font-size:0.8rem; margin-bottom:30px;">Digitalizing Street Performance</p>
    <button id="btn-enter" style="background:#E50914; color:white; border:none; padding:15px 50px; border-radius:40px; font-weight:bold; cursor:pointer; font-size:1rem; box-shadow: 0 0 20px rgba(229,9,20,0.4);">
        MASUK & PLAY
    </button>
    <audio id="bgm-player" loop></audio>
</div>
    <!-- NAVBAR -->
    <nav class="top-nav">
        <a href="index.html" class="logo-container">
            <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/refs/heads/main/Logo_Stretart.png" alt="Logo" class="logo-img" style="height: 50px;">
            <span class="logo-text">SMIPRO</span>
        </a>
        <div class="menu" style="display:flex; align-items:center;">
             <a href="about.html" style="color:#E50914; text-decoration:none; margin-right:15px; font-size:1.2rem;" title="Tentang SMIPRO">
                <i class="fa-solid fa-circle-info"></i>
            </a>
            <!-- WADAH TOMBOL LOGIN/USER (ID PENTING) -->
            <div id="nav-btn-area">
                <a href="login.html" class="btn-mitra">
                    <i class="fa-solid fa-user-gear"></i> Mitra (Login/Daftar)
                </a>
            </div>
        </div>
    </nav>

    <!-- HEADER + NARASI -->
    <header class="hero">
        <div class="hero-content">
            <span class="brand-badge">LIVE 2025</span>
            <h1 style="margin:10px 0;">SMIPRO</h1>
            <div class="prolog-box">
                "Memodernisasi sektor seni pertunjukan "jalanan" adalah upaya perbaikan tatakelola zona legal ekonomi kreatif untuk sebuah misi pertumbuhan ekonomi inklusif dan berkelanjutan"
            </div>
        </div>
    </header>

    <div class="container">

        <!-- === JADWAL UTAMA === -->
       <div id="home-schedule-container" style="display:none;"></div>

       <!-- === JADWAL TOUR / CAFE (Awalnya Kosong) === -->
        <div id="home-tour-container" style="display:none;"></div>

        <!-- === RADIO CARD (Awalnya Kosong) === -->
        <div id="home-radio-container" style="display:none;"></div>
        
        <!-- 1. LIST ANGKRINGAN -->
        <div class="section-title"><i class="fa-solid fa-map-location-dot"></i> 5 Angkringan Live</div>
        <div id="venue-list-container">
            <p style="text-align:center; color:#888; padding:20px;">
                <i class="fa-solid fa-spinner fa-spin"></i> Memuat Lokasi...
            </p>
        </div>

       <!-- 2. TOP 5 PERFORMER -->
        <div class="section-title"><i class="fa-solid fa-guitar"></i> Top 5 Performers (Profil)</div>
        <div class="performer-wrap" id="top-performer-container">
            <p style="text-align:center; width:100%; color:#888;">Memuat Artis...</p>
        </div>

        <!-- 3. BENGKEL PERFORM -->
        <div class="training-banner" onclick="location.href='training.html'" 
     style="background: linear-gradient(135deg, #b40000, #ffde10); border: 1px solid #ffde10;">
    
    <div>
        <!-- Tulisan Judul jadi Hitam -->
        <h3 style="margin:0; color: black; text-shadow: none;">Bengkel Perform SMIPRO</h3>
        
        <!-- Tulisan Kecil jadi Hitam -->
        <small style="color: black; font-weight: 600;">Klik untuk melihat Tim Pelatih</small>
    </div>
    
    <!-- Ikon Toga jadi Hitam -->
    <i class="fa-solid fa-graduation-cap" style="font-size:2rem; color: black;"></i>

</div>
                
       <!-- 4. PODCAST HIGHLIGHT (SUDAH DINAMIS) -->
        <div class="section-title" style="margin-top: 50px;">
            <i class="fa-solid fa-photo-film"></i> Galeri & Podcast Terbaru
        </div>

        <!-- WADAH INI NANTI DIISI OTOMATIS OLEH JAVASCRIPT -->
        <div id="home-podcast-container" style="margin-bottom: 20px;">
            <p style="text-align:center; color:#888;">
                <i class="fa-solid fa-circle-notch fa-spin"></i> Memuat konten...
            </p>
        </div>

        <!-- 5. DUKUNG KAMI (REVISI) -->
        <div class="support-section">
            <h3 style="margin:0; color:white;">Dukung SMIPRO.Street.Art</h3>
            <p style="font-size:0.9rem; color:#888;">Follow akun resmi kami untuk update terbaru.</p>
            
            <div class="social-icons">
                <!-- 1. YOUTUBE (Link Aktif) -->
                <a href="https://www.youtube.com/@SmiproStreetart" target="_blank" style="color:red;" title="YouTube SMIPRO">
                    <i class="fa-brands fa-youtube"></i>
                </a>

                <!-- 2. TIKTOK (Ganti tanda # dengan link nanti) -->
                <a href="https://www.tiktok.com/@smipro_streetart" target="_blank" style="color:#00f2ea;" title="TikTok">
                    <i class="fa-brands fa-tiktok"></i>
                </a>

                <!-- 3. INSTAGRAM (Ganti tanda # dengan link nanti) -->
                <a href="https://www.instagram.com/smipro.streetart/" target="_blank" style="color:#C13584;" title="Instagram">
                    <i class="fa-brands fa-instagram"></i>
                </a>

                <!-- 4. FACEBOOK (Ganti tanda # dengan link nanti) -->
                <a href="https://www.facebook.com/profile.php?id=61586115930975&locale=id_ID" target="_blank" style="color:#1877F2;" title="Facebook">
                    <i class="fa-brands fa-facebook-f"></i>
                </a>
            </div>
            
            <!-- Tombol Donasi sudah dihapus -->
        </div>

        <!-- 6. BERITA -->
        <div class="section-title"><i class="fa-regular fa-newspaper"></i> Berita Terbaru</div>
        <div id="home-news-container">
            <div class="news-card"><div>Memuat Berita...</div></div>
        </div>

        <br><br>
        <center><small style="color:#444;">&copy; 2025 Yayasan Sekolah Konang Indonesia - SMIPRO StreetArt.ID</small></center>
    </div>

    <!-- SCRIPT TUNGGAL (GABUNGAN LOGIC & DATA) -->
    <script type="module">
        import { db } from './firebase-config.js';
        import { 
    collection, getDocs, query, orderBy, limit, addDoc, updateDoc, doc, getDoc, onSnapshot, where 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ==========================================
        // 1. CEK STATUS LOGIN (INIT PERTAMA KALI)
        // ==========================================
        function checkAuthStatus() {
            const isLoggedIn = localStorage.getItem('userLoggedIn');
            const userName = localStorage.getItem('userName');
            const userRole = localStorage.getItem('userRole'); 
            
            // Logika Fallback Link Dashboard
            let userLink = localStorage.getItem('userLink');
            if (!userLink || userLink === 'null') {
                if (userRole === 'mitra') userLink = 'mitra-dashboard.html';
                else if (userRole === 'performer') userLink = 'performer-dashboard.html';
                else if (userRole === 'mentor') userLink = 'mentor-dashboard.html';
                else if (userRole === 'admin') userLink = 'admin-dashboard.html';
                else userLink = '#';
            }

            const navArea = document.getElementById('nav-btn-area');
            if (navArea) {
                if (isLoggedIn === 'true') {
                    // TENTUKAN IKON & WARNA
                    let icon = 'fa-user'; 
                    let color = '#E50914'; 
                    
                    if (userRole === 'mitra') icon = 'fa-store';
                    if (userRole === 'performer') icon = 'fa-guitar';
                    if (userRole === 'mentor') icon = 'fa-graduation-cap';
                    
                    if (userRole === 'admin') {
                        icon = 'fa-user-shield';
                        color = '#ff0000'; 
                    }

                    // TAMPILKAN NAMA USER (KLIK MASUK DASHBOARD)
                    navArea.innerHTML = `
                        <a href="${userLink}" style="text-decoration:none; display:flex; align-items:center; gap:8px; color:${color}; font-weight:800; font-size:1rem;">
                            <i class="fa-solid ${icon}"></i> ${userName}
                        </a>
                    `;
                } else {
                    // BELUM LOGIN
                    navArea.innerHTML = `
                        <a href="login.html" class="btn-mitra">
                            <i class="fa-solid fa-user-gear"></i> Mitra (Login/Daftar)
                        </a>
                    `;
                }
            }
        }

        // ==========================================
        // 2. FUNGSI LOAD DATA
        // ==========================================
        
        // JADWAL
        async function loadMainSchedule() {
            const container = document.getElementById('home-schedule-container');
            const q = query(collection(db, "events"), orderBy("date", "asc")); 
            const querySnapshot = await getDocs(q);

            let foundMain = false;

            // Bersihkan dulu
            container.innerHTML = '';
            
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                if (data.type === 'main' && !foundMain) { 
                    foundMain = true;

                    // MUNCULKAN KOTAKNYA
                    container.style.display = 'block';
                    
                    let artistNames = data.performers ? data.performers.map(p => p.name).join(", ") : "Artis Pilihan";
                    const dateParts = data.displayDate.split(' '); 
                    const hari = dateParts[0].replace(',','').toUpperCase();
                    const tgl = dateParts[1];
                    const blnThn = dateParts[2].substr(0,3).toUpperCase() + " " + dateParts[3];

                    container.innerHTML = `
                    <div class="main-schedule-card" onclick="location.href='schedule.html'">
                        <div class="msc-date">
                            <span style="font-size:0.8rem; letter-spacing:2px;">${hari}</span>
                            <span style="font-size:2.5rem; font-weight:800; line-height:1;">${tgl}</span>
                            <span style="font-size:0.9rem; font-weight:bold;">${blnThn}</span>
                        </div>
                        <div class="msc-info">
                            <div class="msc-badge">MINGGU INI</div>
                            <h3 style="margin:5px 0 5px 0; color:white;">Live Performance</h3>
                            <p style="color:#ccc; font-size:0.9rem; margin:0;">
                                <i class="fa-solid fa-microphone-lines" style="color:var(--primary);"></i> ${artistNames}
                            </p>
                            <small style="color:var(--accent); margin-top:5px; display:block;">
                                <i class="fa-solid fa-hand-pointer"></i> Klik untuk detail & jadwal bulan depan
                            </small>
                        </div>
                    </div>`;
                }
            });

            if(!foundMain) container.innerHTML = `<div class="main-schedule-card"><div class="msc-info">Belum ada jadwal minggu ini.</div></div>`;
        }

       // 4. LOAD RADIO (TAMPILKAN WALAU OFFLINE)
        async function loadMainRadio() {
            const container = document.getElementById('home-radio-container');
            // Urutkan dari Pagi (1) ke Malam (3)
            const q = query(collection(db, "broadcasts"), orderBy("order", "asc")); 
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                container.style.display = 'none';
                return;
            }

            let dataToShow = null;

            // 1. Cek apakah ada yang LIVE?
            querySnapshot.forEach(doc => {
                if (doc.data().isLive) dataToShow = doc.data();
            });

            // 2. Jika TIDAK ada yang Live, ambil jadwal pertama (Pagi) sebagai info
            if (!dataToShow) {
                dataToShow = querySnapshot.docs[0].data();
            }

            container.style.display = 'block';
            container.innerHTML = '';
           
            // Logika Tampilan (Biru jika Live, Abu jika Offline)
            const isLive = dataToShow.isLive;
            const badgeStyle = isLive ? 'background:#ff0000; color:white; border:none; animation: pulse 1s infinite;' : 'background:#00d2ff; color:black; border:none;';
            const badgeText = isLive ? 'LIVE SEKARANG' : 'SEGERA TAYANG';
            const titleColor = isLive ? 'white' : '#888';
            const iconColor = isLive ? 'cyan-text' : 'style="color:#555"';
            
            container.innerHTML = `
            <div class="main-schedule-card" onclick="location.href='radio.html'" style="cursor:pointer; border-left: 5px solid #00d2ff; background: linear-gradient(135deg, #001a22 0%, #000 100%);">
                <div class="msc-date" style="background:#00d2ff; color:black;">
                    <span style="font-size:0.8rem; letter-spacing:2px;">${dataToShow.sessionName || 'RADIO'}</span>
                    <span style="font-size:2.5rem; font-weight:800; line-height:1;">${dataToShow.time ? dataToShow.time.split(':')[0] : '00'}</span>
                    <span style="font-size:0.9rem; font-weight:bold;">WIB</span>
                </div>
                <div class="msc-info">
                    <div class="msc-badge" style="${badgeStyle}">${badgeText}</div>
                    <h3 style="margin:5px 0 5px 0; color:white;">${dataToShow.title}</h3>
                    <p style="color:#ddd; font-size:0.9rem; margin:0;">
                        <i class="fa-brands fa-tiktok" style="color:#00d2ff;"></i> Topik: "${dataToShow.topic}"
                    </p>
                    <small style="color:#aaa; margin-top:5px; display:block;">
                        <i class="fa-solid fa-paper-plane" style="color:#00d2ff;"></i> Klik untuk Request & Gabung
                    </small>
                </div>
            </div>`;
        }

       // JADWAL TOUR (CAFE)
        // 3. LOAD JADWAL TOUR (CAFE) - VERSI ANTI ERROR
        async function loadTourSchedule() {
            const container = document.getElementById('home-tour-container');
            
            // PERBAIKAN: Hapus 'orderBy' sementara agar tidak kena error Index Firebase
            // Kita ambil data tour apa saja yang ada
            const q = query(collection(db, "events"), where("type", "==", "tour"), limit(1));
            
            try {
                const querySnapshot = await getDocs(q);

                // JIKA KOSONG DI DATABASE: Tampilkan Dummy Biar Kelihatan Dulu
                if (querySnapshot.empty) {
                    console.log("Data Tour Kosong. Memeriksa...");
                    // Opsional: uncomment baris bawah ini jika ingin paksa muncul dummy
                    // await seedTourData(); return loadTourSchedule(); 
                    container.style.display = 'none';
                    return;
                }

                // JIKA ADA DATA
                container.style.display = 'block';
                container.innerHTML = '';

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    
                    // Format Tanggal (Fallback jika kosong)
                    const displayDate = data.displayDate || "COMING SOON";
                    const dateParts = displayDate.split(' '); 
                    // Ambil angka tanggal (misal bagian kedua: "03" dari "SABTU 03 JAN")
                    const tgl = dateParts.length > 1 ? dateParts[1] : 'New';

                    // Ambil Nama Artis
                    let artistName = "Guest Star";
                    if(data.performers && data.performers.length > 0) {
                        artistName = data.performers[0].name;
                    }

                    // TAMPILKAN KARTU
                    container.innerHTML = `
                    <div class="main-schedule-card" onclick="location.href='cafe-live.html?loc=${encodeURIComponent(data.location)}'" style="cursor:pointer; border-left: 5px solid #ff9800; margin-bottom: 20px;">
                        <div class="msc-date" style="background:#ff9800; color:black;">
                            <span style="font-size:0.8rem; letter-spacing:2px;">TOUR</span>
                            <span style="font-size:2.5rem; font-weight:800; line-height:1;">${tgl}</span>
                        </div>
                        <div class="msc-info">
                            <div class="msc-badge" style="background:#ff9800; color:black; border:none; font-weight:bold;">SMIPRO ON TOUR</div>
                            <h3 style="margin:5px 0 5px 0; color:white;">${data.location}</h3>
                            <p style="color:#ccc; font-size:0.9rem; margin:0;">
                                <i class="fa-solid fa-guitar" style="color:#ff9800;"></i> ${artistName}
                            </p>
                            <small style="color:#888; margin-top:5px; display:block;">
                                <i class="fa-solid fa-arrow-right"></i> Klik untuk Request & Sawer
                            </small>
                        </div>
                    </div>`;
                });
            } catch (error) {
                console.error("Error loading tour:", error);
            }
        }

        // VENUES (DENGAN PERBAIKAN ADMIN AKSES)
       async function loadVenues() {
            const container = document.getElementById('venue-list-container');
            const userRole = localStorage.getItem('userRole');
            const isAdmin = userRole === 'admin';

            const q = query(collection(db, "venues"), orderBy("order", "asc"));
            
            onSnapshot(q, (snapshot) => {
                if(snapshot.empty) {
                    container.innerHTML = `<p style="text-align:center;color:#666;">Lokasi belum tersedia.</p>`;
                    return;
                }

                container.innerHTML = '';
                
                snapshot.forEach(docSnap => {
                    const data = docSnap.data();
                    const isOpen = data.status === 'open';
                    const badgeClass = isOpen ? 'active' : 'soon';
                    const badgeText = isOpen ? 'BUKA' : 'TUTUP';
                    
                    // Tombol Saklar Admin
                    let adminSwitchHTML = "";
                    if (isAdmin) {
                        const toggleColor = isOpen ? '#00ff00' : '#333';
                        const toggleIcon = isOpen ? 'fa-toggle-on' : 'fa-toggle-off';
                        
                        adminSwitchHTML = `
                        <div style="margin-left:10px; text-align:center; z-index:100; cursor:pointer;" 
                             onclick="event.stopPropagation(); window.toggleVenueStatus('${docSnap.id}', '${data.status}')">
                            <i class="fa-solid ${toggleIcon}" style="color:${toggleColor}; font-size:2rem; transition:0.3s;"></i>
                            <div style="font-size:0.6rem; color:#888;">ADMIN</div>
                        </div>`;
                    }

                    // RENDER HTML (Perhatikan onlclick memanggil fungsi yang ada di screenshot Anda)
                    container.innerHTML += `
                    <div class="venue-card ${isOpen ? '' : 'disabled'}" 
                         onclick="window.handleVenueClick('${docSnap.id}', '${data.status}')" 
                         style="display:flex; align-items:center; cursor:pointer;">
                        
                        <div class="icon-box"><i class="fa-solid ${data.icon}"></i></div>
                        
                        <div style="flex:1;">
                            <h3 style="margin:0;">${data.name} <span class="badge ${badgeClass}">${badgeText}</span></h3>
                            <small style="color:#888;">${data.desc}</small>
                        </div>
                        
                        ${adminSwitchHTML}
                    </div>`;
                });
            });
        }

        // TOP PERFORMERS
        async function loadTopPerformers() {
            const container = document.getElementById('top-performer-container');
            const q = query(collection(db, "performers"), orderBy("rating", "desc"), limit(5));
            const querySnapshot = await getDocs(q);

            if(querySnapshot.empty) {
                container.innerHTML = '<p style="text-align:center; width:100%; color:#666;">Belum ada performer.</p>';
                return;
            }

            container.innerHTML = '';
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const defaultImg = "https://via.placeholder.com/150";
                container.innerHTML += `
                <div class="artist-card" onclick="location.href='profile.html?id=${doc.id}'">
                    <img src="${data.img || defaultImg}" class="artist-img">
                    <div>${data.name}</div>
                </div>`;
            });
        }

        // BERITA
        async function loadNews() {
            const container = document.getElementById('home-news-container');
            const q = query(collection(db, "news"), orderBy("date", "desc"), limit(1));
            const querySnapshot = await getDocs(q);

            if(querySnapshot.empty) {
                container.innerHTML = '<div class="news-card"><div>Belum ada berita.</div></div>';
                return;
            }
            container.innerHTML = '';
            querySnapshot.forEach(doc => {
                const data = doc.data();
                let clickAction = data.type === 'external' ? `window.open('${data.url}', '_blank')` : `location.href='news-read.html?id=${doc.id}'`;
                container.innerHTML += `
                <div class="news-card" onclick="${clickAction}" style="cursor:pointer;">
                    <img src="${data.thumb}" class="news-thumb">
                    <div>
                        <span style="color:var(--primary); font-size:0.7rem; font-weight:bold;">${data.tag}</span>
                        <h4 style="margin:5px 0;">${data.title}</h4>
                        <p style="margin:0; font-size:0.7rem; color:#888;">${data.date}</p>
                    </div>
                </div>`;
            });
        }

        // ==========================================
        // 3. FUNGSI GLOBAL (ADMIN ONLY)
        // ==========================================
        window.toggleVenueStatus = async function(id, currentStatus) {
            event.stopPropagation(); 
            const newStatus = currentStatus === 'open' ? 'closed' : 'open';
            if(confirm(`Ubah status menjadi ${newStatus.toUpperCase()}?`)) {
                await updateDoc(doc(db, "venues", id), { status: newStatus });
            }
        }

        // --- FUNGSI BARU: KLIK VENUE (AMAN DARI ERROR) ---
window.handleVenueClick = function(id, status) {
    const userRole = localStorage.getItem('userRole');
    const isAdmin = userRole === 'admin';
    const isOpen = status === 'open';

    // Logika: Admin bebas masuk, User biasa harus cek status buka
    if (isAdmin || isOpen) {
        window.location.href = `venue-stadion.html?id=${id}`;
    } else {
        alert('Maaf, lokasi ini sedang tutup/belum beroperasi.');
    }
}

        // --- FUNGSI BARU: LOAD PODCAST HIGHLIGHT ---
        async function loadPodcastHighlight() {
            const container = document.getElementById('home-podcast-container');
            
            // Ambil 1 data terbaru berdasarkan timestamp
            const q = query(collection(db, "podcasts"), orderBy("timestamp", "desc"), limit(1));
            const snapshot = await getDocs(q);
        
            if (snapshot.empty) {
                container.innerHTML = `<div class="podcast-card"><div style="padding:20px; text-align:center;">Belum ada konten galeri.</div></div>`;
                return;
            }
        
            snapshot.forEach(doc => {
                const d = doc.data();
                
                // Cek Tipe: Video atau Audio?
                const isVideo = d.mediaType === 'video';
                
                // Atur Tampilan
                const typeIcon = isVideo ? 'fa-brands fa-youtube' : 'fa-brands fa-spotify';
                const typeColor = isVideo ? '#ff0000' : '#1DB954'; 
                const typeLabel = isVideo ? 'VIDEO TERBARU' : 'AUDIO TERBARU';
                const thumbImg = d.thumb || "https://via.placeholder.com/400x200?text=No+Cover";
        
                // Render Kartu Keren
                container.innerHTML = `
                <div class="podcast-card" onclick="location.href='podcast.html'" style="cursor:pointer; border:1px solid #333; overflow:hidden; position:relative;">
                    
                    <!-- GAMBAR COVER -->
                    <div style="position:relative; height:200px; overflow:hidden;">
                        <img src="${thumbImg}" style="width:100%; height:100%; object-fit:cover; filter: brightness(0.7);">
                        
                        <!-- Label Pojok -->
                        <div style="position:absolute; top:10px; left:10px; background:${typeColor}; color:white; padding:3px 8px; border-radius:4px; font-size:0.7rem; font-weight:bold;">
                            <i class="${typeIcon}"></i> ${typeLabel}
                        </div>
        
                        <!-- Tombol Play -->
                        <i class="fa-solid fa-circle-play play-btn-center" style="font-size:3.5rem; color:white; opacity:0.9; text-shadow: 0 0 10px rgba(0,0,0,0.5);"></i>
                    </div>
        
                    <!-- INFO BAWAH -->
                    <div class="podcast-info" style="padding:15px; background: linear-gradient(to right, #111, #000);">
                        <h4 style="margin:0 0 5px 0; color:white; font-size:1.1rem; line-height:1.4;">${d.title}</h4>
                        <div style="color:#888; font-size:0.85rem;">
                            <i class="fa-solid fa-user-pen"></i> ${d.host || 'Admin'}
                        </div>
                    </div>
                </div>`;
            });
        }

        // --- LOGIKA WELCOME SCREEN & BGM (DINAMIS DARI ADMIN) ---
async function initWelcomeScreen() {
    console.log("Memulai pengecekan Welcome Screen..."); // Laporan 1
    
    const overlay = document.getElementById('welcome-overlay');
    const player = document.getElementById('bgm-player');
    const btn = document.getElementById('btn-enter');

    try {
        const docSnap = await getDoc(doc(db, "settings", "general"));
        
        if (docSnap.exists()) {
            const data = docSnap.data();
            console.log("Data Settings Ditemukan:", data); // Laporan 2

            if (data.bgmEnabled && data.bgmUrl) {
                console.log("Welcome Screen AKTIF. Menampilkan..."); // Laporan 3
                overlay.style.display = 'flex';
                player.src = data.bgmUrl;
                
                btn.onclick = () => {
                    player.play();
                    overlay.style.opacity = '0';
                    setTimeout(() => overlay.style.display = 'none', 500);
                };
            } else {
                console.log("Welcome Screen MATI di settings."); // Laporan 4
                overlay.style.display = 'none';
            }
        } else {
            console.log("Dokumen settings/general tidak ditemukan di Database.");
        }
    } catch (e) { 
        console.error("Error saat memuat BGM:", e);
    }
}
        
        // ==========================================
        // 4. EKSEKUSI
        // ==========================================
        checkAuthStatus(); // Cek Login Dulu
        loadMainSchedule();
        loadTourSchedule();
        loadMainRadio();
        loadVenues();
        loadTopPerformers();
        loadNews();
        loadPodcastHighlight();
        initWelcomeScreen(); 

    </script>
</body>
</html>

