<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Warung - SMIPRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* (Style lama tetap sama, saya tambahkan style QR) */
        .mitra-header-bg { height: 150px; background: url('https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/refs/heads/main/Bener%20Dasboard3.jpg') center/cover; position: relative; }
        .mitra-header-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, transparent, #121212); }
        .mitra-profile-pic { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--primary); position: absolute; bottom: -40px; left: 20px; object-fit: cover; background: #000; cursor: pointer; }
        .mitra-controls { padding: 50px 20px 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .shop-switch { display: flex; align-items: center; gap: 10px; cursor: pointer; background: #222; padding: 5px 15px; border-radius: 20px; border: 1px solid #444; }
        .shop-switch.open { border-color: #00ff00; }
        .shop-switch.closed { border-color: red; }
        .indicator { width: 10px; height: 10px; border-radius: 50%; background: red; }
        .shop-switch.open .indicator { background: #00ff00; box-shadow: 0 0 10px #00ff00; }
        
        .mitra-tabs { display: flex; justify-content: space-around; background: #111; border-bottom: 1px solid #333; margin-bottom: 20px; overflow-x: auto; }
        .tab-btn { flex: 1; padding: 15px; background: none; border: none; color: #888; font-weight: bold; cursor: pointer; border-bottom: 3px solid transparent; white-space: nowrap; }
        .tab-btn.active { color: white; border-bottom-color: var(--primary); }
        
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        .stat-card-mitra { background: #1e1e1e; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #333; position: relative; }
        .edit-icon { position: absolute; top: 10px; right: 10px; color: #888; cursor: pointer; font-size: 0.9rem; }
        .booking-cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 15px; }
        .card-booking.waiting { background: #332b00; border-left: 5px solid #ffeb3b; padding: 15px; border-radius: 8px; }
        .card-booking.active { background: #2a0000; border-left: 5px solid red; padding: 15px; border-radius: 8px; }
        .waiting-text { color: #ffeb3b; font-size: 0.8rem; margin-top: 10px; font-style: italic; }
        .active-text { color: red; font-weight: bold; font-size: 0.8rem; margin-top: 10px; }
        .table-badge { font-size: 1.2rem; font-weight: bold; color: white; display: block; margin-bottom: 5px; }
        .menu-item { display: flex; gap: 15px; background: #222; padding: 10px; border-radius: 10px; margin-bottom: 10px; align-items: center; border: 1px solid #333; }
        .menu-thumb { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
        .btn-delete { background: #333; color: #ff4444; border: 1px solid #555; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .profile-form label { display: block; color: #aaa; margin-top: 15px; font-size: 0.9rem; }
        .input-mitra { width: 100%; background: #111; border: 1px solid #444; color: white; padding: 12px; border-radius: 5px; margin-top: 5px; }

        /* CSS KHUSUS QR GRID */
        .qr-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; margin-top: 20px; }
        .qr-card { background: white; padding: 15px; border-radius: 10px; text-align: center; color: black; }
        .qr-card img { width: 100%; max-width: 120px; }
        .qr-card h4 { margin: 5px 0 0 0; font-size: 1.2rem; color: #000; }
        .print-note { background: #222; padding: 15px; border-radius: 10px; border: 1px dashed #555; margin-bottom: 20px; font-size: 0.9rem; color: #ccc; }
    </style>
</head>
<body>

    <div class="mitra-header-bg">
        <div class="mitra-header-overlay"></div>
         <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/main/Logo_Stretart.png" 
             style="position:absolute; top:15px; left:15px; width:50px; z-index:10; filter:drop-shadow(0 0 5px rgba(0,0,0,0.5));" 
             alt="Logo SMIPRO">
        
        <!-- FOTO PROFIL WARUNG -->
        <img src="https://images.unsplash.com/photo-1541544744-5e3a01998cd1?q=80&w=200" class="mitra-profile-pic" onclick="alert('Fitur Ganti Foto Profil Warung')">
        <button onclick="location.href='index.html'" style="position:absolute; top:20px; right:20px; background:rgba(0,0,0,0.6); color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">Logout</button>
    </div>
    
    <div class="mitra-controls">
        <div>
            <h2 style="margin:0;" id="shop-name-display">Warung Bu Sri</h2>
            <small style="color:#aaa;">Stadion Bayuangga Zone</small>
        </div>
        <div class="shop-switch open" id="store-status-btn" onclick="toggleStoreStatus()">
            <div class="indicator"></div>
            <span id="store-status-text" style="font-weight:bold; font-size:0.9rem;">BUKA</span>
        </div>
    </div>
<!-- TOMBOL NAVIGASI POJOK KANAN ATAS -->
        <div style="position:absolute; top:20px; right:20px; display:flex; gap:10px;">
            <!-- Tombol Ke Home (Tanpa Logout) -->
            <button onclick="location.href='index.html'" style="background:rgba(255,255,255,0.2); color:white; border:1px solid white; padding:5px 12px; border-radius:5px; cursor:pointer;">
                <i class="fa-solid fa-house"></i> Home
            </button>
            <button onclick="prosesLogout()" style="background:rgba(229, 9, 20, 0.8); color:white; border:none; padding:5px 12px; border-radius:5px; cursor:pointer;">
                <i class="fa-solid fa-right-from-bracket"></i> Logout
            </button>
        </div>
    </div>
    <!-- TAB NAVIGASI -->
    <div class="mitra-tabs">
        <button class="tab-btn active" onclick="switchTab('home')"><i class="fa-solid fa-house"></i> Beranda</button>
        <button class="tab-btn" onclick="switchTab('qr')"><i class="fa-solid fa-print"></i> QR Meja</button> <!-- NEW -->
        <button class="tab-btn" onclick="switchTab('menu')"><i class="fa-solid fa-utensils"></i> Menu</button>
        <button class="tab-btn" onclick="switchTab('profile')"><i class="fa-solid fa-gear"></i> Profil</button>
    </div>

    <div class="container">
        
        <!-- TAB 1: BERANDA -->
        <div id="tab-home" class="tab-content active">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:30px;">
                <div class="stat-card-mitra">
                    <i class="fa-solid fa-pen edit-icon" onclick="editTableCount()"></i>
                    <h1 id="total-table-count" style="margin:0; color:var(--primary);">15</h1>
                    <small>Total Meja</small>
                </div>
                <div class="stat-card-mitra">
                    <h1 id="occupied-count" style="margin:0; color:white;">0</h1>
                    <small>Meja Terisi</small>
                </div>
            </div>
            <div class="section-title"><i class="fa-solid fa-list-check"></i> Pesanan Masuk</div>
            <div id="booking-container" class="booking-cards-grid"></div>
        </div>

        <!-- TAB 2: QR MEJA (NEW) -->
        <div id="tab-qr" class="tab-content">
            <div class="print-note">
                <i class="fa-solid fa-circle-info" style="color:var(--accent);"></i>
                <b>Panduan Mitra:</b><br>
                1. Download atau Screenshot QR Code di bawah.<br>
                2. Print dan tempel di masing-masing meja sesuai nomornya.<br>
                3. Pengunjung yang datang <b>WAJIB SCAN</b> QR ini untuk konfirmasi kehadiran.
            </div>
            <div id="qr-container" class="qr-grid">
                <!-- QR Generated by JS -->
            </div>
        </div>

        <!-- TAB 3: KELOLA MENU -->
        <div id="tab-menu" class="tab-content">
            <button class="btn-primary" onclick="openModalMenu()" style="margin-bottom:20px;">
                <i class="fa-solid fa-plus"></i> Tambah Menu Baru
            </button>
            <div id="menu-list-container"></div>
        </div>

        <!-- TAB 4: PROFIL WARUNG -->
        <div id="tab-profile" class="tab-content">
            <div class="profile-form" style="background:#1e1e1e; padding:20px; border-radius:10px; border:1px solid #333;">
                <h3 style="margin-top:0; border-bottom:1px solid #333; padding-bottom:10px;">Pengaturan Akun</h3>
                
                <!-- MENU GANTI FOTO PROFIL -->
                <div style="text-align:center; margin-bottom:20px;">
                    <img src="https://images.unsplash.com/photo-1541544744-5e3a01998cd1?q=80&w=200" id="preview-profile" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:3px solid var(--primary); margin-bottom:10px;">
                    <br>
                    <button class="btn-small" style="background:#333; border:1px solid #555;" onclick="alert('Membuka Galeri HP...')"><i class="fa-solid fa-camera"></i> Ganti Foto Profil</button>
                </div>

                <label>Nama Warung</label>
                <input type="text" id="edit-name" class="input-mitra" value="Warung Bu Sri">

                <label>Nomor HP / WhatsApp</label>
                <input type="text" id="edit-phone" class="input-mitra" value="08123456789">

                <label>Password Login</label>
                <input type="password" id="edit-pass" class="input-mitra" value="123456">

                <button class="btn-primary" onclick="saveProfile()" style="margin-top:20px;">SIMPAN PERUBAHAN</button>
            </div>
        </div>

    <!-- MODAL MENU -->
    <div id="modal-menu" class="modal-overlay" style="display:none;">
        <div class="modal-box">
            <h3>Tambah Menu</h3>
            <input type="text" id="new-menu-name" class="input-mitra" placeholder="Nama Makanan">
            <input type="number" id="new-menu-price" class="input-mitra" placeholder="Harga (Rp)">
            <textarea id="new-menu-desc" class="input-mitra" placeholder="Deskripsi singkat" style="height:60px;"></textarea>
            <div style="margin-top:10px; padding:10px; border:1px dashed #555; text-align:center; border-radius:5px; cursor:pointer;" onclick="alert('Buka Galeri HP')"><i class="fa-solid fa-camera"></i> Upload Foto</div>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn-small" style="background:#444;" onclick="closeModalMenu()">Batal</button>
                <button class="btn-small" style="background:var(--primary);" onclick="addMenu()">Simpan</button>
            </div>
        </div>
    </div>

    <script type="module" src="mitra-script.js"></script>

        <!-- TOMBOL KHUSUS ADMIN (Hanya muncul jika mode Admin) -->
<div id="admin-floating-btn" style="display:none; position:fixed; bottom:20px; left:20px; z-index:9999;">
    <button onclick="backToAdmin()" style="background:#E50914; color:white; padding:15px 25px; border:2px solid white; border-radius:30px; font-weight:bold; cursor:pointer; box-shadow:0 0 20px rgba(0,0,0,0.8);">
        <i class="fa-solid fa-user-shield"></i> KEMBALI KE ADMIN
    </button>
</div>

<script>
    // Cek apakah user ini sebenarnya Admin?
    if(localStorage.getItem('userName') && localStorage.getItem('userName').includes('(Mode Admin)')) {
        document.getElementById('admin-floating-btn').style.display = 'block';
    }

    function backToAdmin() {
        // Kembalikan sesi ke Admin
        localStorage.setItem('userLoggedIn', 'true');
        localStorage.setItem('userRole', 'admin');
        localStorage.setItem('userName', 'Super Admin');
        window.close(); // Tutup tab ini (karena admin buka di tab baru)
        // Atau jika tidak di tab baru:
        window.location.href = 'admin-dashboard.html';
    }
</body>
</html>
