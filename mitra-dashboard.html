<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Warung - SMIPRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* STYLE LAMA (Header, Tab, Controls) TETAP SAMA */
        .mitra-header-bg { height: 150px; background: url('https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/refs/heads/main/Bener%20Dasboard3.jpg') center/cover; position: relative; }
        .mitra-header-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, transparent, #121212); }
        .mitra-profile-pic { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--primary); position: absolute; bottom: -40px; left: 20px; object-fit: cover; background: #000; cursor: pointer; z-index: 20; transition: transform 0.3s; }
        .mitra-profile-pic:hover { transform: scale(1.1); border-color: white; }
        .mitra-controls { padding: 50px 20px 10px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .shop-switch { display: flex; align-items: center; gap: 10px; cursor: pointer; background: #222; padding: 5px 15px; border-radius: 20px; border: 1px solid #444; transition: 0.3s; }
        .shop-switch.open { border-color: #00ff00; }
        .shop-switch.closed { border-color: red; }
        .indicator { width: 10px; height: 10px; border-radius: 50%; background: red; transition: 0.3s; }
        .shop-switch.open .indicator { background: #00ff00; box-shadow: 0 0 10px #00ff00; }
        .mitra-tabs { display: flex; justify-content: space-around; background: #111; border-bottom: 1px solid #333; margin-bottom: 20px; overflow-x: auto; }
        .tab-btn { flex: 1; padding: 15px; background: none; border: none; color: #888; font-weight: bold; cursor: pointer; border-bottom: 3px solid transparent; white-space: nowrap; }
        .tab-btn.active { color: white; border-bottom-color: var(--primary); }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        
        /* STYLE BOOKING & STATS */
        .stat-card-mitra { background: #1e1e1e; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #333; position: relative; }
        .edit-icon { position: absolute; top: 10px; right: 10px; color: #888; cursor: pointer; font-size: 0.9rem; }
        .booking-cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 15px; }
        .card-booking.waiting { background: #332b00; border-left: 5px solid #ffeb3b; padding: 15px; border-radius: 8px; }
        .card-booking.active { background: #2a0000; border-left: 5px solid red; padding: 15px; border-radius: 8px; }
        .waiting-text { color: #ffeb3b; font-size: 0.8rem; margin-top: 10px; font-style: italic; }
        .active-text { color: red; font-weight: bold; font-size: 0.8rem; margin-top: 10px; }
        .table-badge { font-size: 1.2rem; font-weight: bold; color: white; display: block; margin-bottom: 5px; }
        .btn-delete { background: #333; color: #ff4444; border: 1px solid #555; padding: 5px 10px; border-radius: 5px; cursor: pointer; }

        /* === NEW STYLE: MENU GRID (KOTAK-KOTAK) === */
        .menu-grid-display {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 Kolom di HP */
            gap: 15px;
        }
        .menu-card {
            background: #222;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #333;
            text-align: center;
        }
        .menu-card img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        .menu-details { padding: 10px; }
        
        /* QR & PROFILE */
        .profile-form label { display: block; color: #aaa; margin-top: 15px; font-size: 0.9rem; }
        .input-mitra { width: 100%; background: #111; border: 1px solid #444; color: white; padding: 12px; border-radius: 5px; margin-top: 5px; }
        .qr-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 20px; margin-top: 20px; }
        .qr-card { background: white; padding: 15px; border-radius: 10px; text-align: center; color: black; }
        .qr-card img { width: 100%; max-width: 120px; }
        .btn-download-qr { background: #333; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin-top: 10px; font-size: 0.8rem; cursor: pointer; }
        .print-note { background: #222; padding: 15px; border-radius: 10px; border: 1px dashed #555; margin-bottom: 20px; font-size: 0.9rem; color: #ccc; }
        
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center; padding: 20px; }
        .modal-box { background: #1e1e1e; padding: 20px; border-radius: 10px; width: 100%; max-width: 350px; border: 1px solid #444; }
        .btn-small { padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <!-- INPUT FILE UNTUK PROFIL -->
    <input type="file" id="file-input" style="display:none;" accept="image/*" onchange="previewImage(this)">
    
    <!-- INPUT FILE UNTUK MENU (BARU) -->
    <input type="file" id="menu-file-input" style="display:none;" accept="image/*" onchange="previewMenuImage(this)">

    <div class="mitra-header-bg">
        <div class="mitra-header-overlay"></div>
         <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/main/Logo_Stretart.png" 
             style="position:absolute; top:15px; left:15px; width:50px; z-index:10;">
        
        <!-- FOTO HEADER -->
        <img src="" class="mitra-profile-pic" id="header-profile-img" onclick="triggerUpload()" onerror="this.src='https://via.placeholder.com/150'">
        
        <div style="position:absolute; top:20px; right:20px; display:flex; gap:10px; z-index:20;">
            <button onclick="goHome()" style="background:rgba(255,255,255,0.2); color:white; border:1px solid white; padding:5px 12px; border-radius:5px; cursor:pointer;">
                <i class="fa-solid fa-house"></i> Home
            </button>
            <button onclick="prosesLogout()" style="background:rgba(229, 9, 20, 0.8); color:white; border:none; padding:5px 12px; border-radius:5px; cursor:pointer;">
                <i class="fa-solid fa-right-from-bracket"></i> Logout
            </button>
        </div>
    </div>
    
    <div class="mitra-controls">
        <div>
            <h2 style="margin:0;" id="shop-name-display">Loading...</h2>
            <small style="color:#aaa;">Stadion Bayuangga Zone</small>
        </div>
        <div class="shop-switch open" id="store-status-btn" onclick="toggleStoreStatus()">
            <div class="indicator"></div>
            <span id="store-status-text" style="font-weight:bold; font-size:0.9rem;">BUKA</span>
        </div>
    </div>

    <div class="mitra-tabs">
        <button class="tab-btn active" onclick="switchTab('home')"><i class="fa-solid fa-house"></i> Beranda</button>
        <button class="tab-btn" onclick="switchTab('qr')"><i class="fa-solid fa-print"></i> QR Meja</button>
        <button class="tab-btn" onclick="switchTab('menu')"><i class="fa-solid fa-utensils"></i> Menu</button>
        <button class="tab-btn" onclick="switchTab('profile')"><i class="fa-solid fa-gear"></i> Profil</button>
    </div>

    <div class="container">
        <!-- TAB 1: BERANDA -->
        <div id="tab-home" class="tab-content active">
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin-bottom:30px;">
                <div class="stat-card-mitra">
                    <i class="fa-solid fa-pen edit-icon" onclick="editTableCount()"></i>
                    <h1 id="total-table-count" style="margin:0; color:var(--primary); font-size:1.5rem;">-</h1>
                    <small style="font-size:0.7rem;">Total Meja</small>
                </div>
                <div class="stat-card-mitra" style="border-color:#ff4444;">
                    <h1 id="occupied-count" style="margin:0; color:#ff4444; font-size:1.5rem;">0</h1>
                    <small style="font-size:0.7rem;">Sedang Makan</small>
                </div>
                <div class="stat-card-mitra" style="border-color:#ffeb3b;">
                    <h1 id="booked-count" style="margin:0; color:#ffeb3b; font-size:1.5rem;">0</h1>
                    <small style="font-size:0.7rem;">Reservasi</small>
                </div>
            </div>
            <div class="section-title"><i class="fa-solid fa-list-check"></i> Pesanan Masuk</div>
            <div id="booking-container" class="booking-cards-grid"></div>
        </div>

        <!-- TAB 2: QR MEJA -->
        <div id="tab-qr" class="tab-content">
            <div class="print-note">
                <i class="fa-solid fa-circle-info" style="color:var(--accent);"></i>
                <b>Panduan:</b> Klik "Download" untuk menyimpan QR, lalu cetak untuk meja.
            </div>
            <div id="qr-container" class="qr-grid"></div>
        </div>

        <!-- TAB 3: MENU (GRID LAYOUT) -->
        <div id="tab-menu" class="tab-content">
            <button class="btn-primary" onclick="openModalMenu()" style="margin-bottom:20px; width:100%; background:var(--primary); padding:12px; border:none; border-radius:5px; color:white; font-weight:bold; cursor:pointer;">
                <i class="fa-solid fa-plus"></i> Tambah Menu Baru
            </button>
            <div id="menu-list-container" class="menu-grid-display"></div>
        </div>

        <!-- TAB 4: PROFIL LENGKAP -->
        <div id="tab-profile" class="tab-content">
            <div class="profile-form" style="background:#1e1e1e; padding:20px; border-radius:10px; border:1px solid #333;">
                <h3 style="margin-top:0; border-bottom:1px solid #333; padding-bottom:10px;">Pengaturan Akun</h3>
                
                <div style="text-align:center; margin-bottom:20px;">
                    <img src="" id="preview-profile-img" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:3px solid var(--primary); margin-bottom:10px;" onerror="this.src='https://via.placeholder.com/150'">
                    <br>
                    <button class="btn-small" style="background:#333; border:1px solid #555; color:white;" onclick="triggerUpload()"><i class="fa-solid fa-camera"></i> Ganti Foto Profil</button>
                </div>

                <label>Nama Warung</label>
                <input type="text" id="edit-name" class="input-mitra">

                <label>Nama Pemilik</label>
                <input type="text" id="edit-owner" class="input-mitra" placeholder="Nama Pemilik">

                <label>Nomor WhatsApp</label>
                <input type="number" id="edit-phone" class="input-mitra" placeholder="08xxxxxxx">

                <label>Email Login</label>
                <input type="email" id="edit-email" class="input-mitra" placeholder="email@contoh.com">

                <label>Password</label>
                <input type="password" id="edit-pass" class="input-mitra" placeholder="******">

                <button class="btn-primary" onclick="saveProfile()" style="margin-top:20px; width:100%; background:var(--green); border:none; padding:12px; border-radius:5px; color:black; font-weight:bold; cursor:pointer;">SIMPAN PERUBAHAN</button>
            </div>
        </div>
    </div>

    <!-- MODAL MENU (DENGAN FOTO) -->
    <div id="modal-menu" class="modal-overlay">
        <div class="modal-box">
            <h3 style="margin-top:0;">Tambah Menu</h3>
            
            <!-- PREVIEW FOTO MENU -->
            <div style="text-align:center; margin-bottom:10px; border:1px dashed #555; padding:10px; border-radius:5px; cursor:pointer;" onclick="triggerMenuUpload()">
                <img id="preview-menu-img" src="https://via.placeholder.com/100?text=Foto" style="width:100px; height:100px; object-fit:cover;">
                <p style="font-size:0.8rem; color:#aaa; margin:5px 0;">Klik untuk Upload Foto</p>
            </div>

            <input type="text" id="new-menu-name" class="input-mitra" placeholder="Nama Makanan">
            <input type="number" id="new-menu-price" class="input-mitra" placeholder="Harga (Rp)">
            <textarea id="new-menu-desc" class="input-mitra" placeholder="Deskripsi singkat" style="height:60px;"></textarea>
            
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn-small" style="background:#444; color:white; flex:1;" onclick="closeModalMenu()">Batal</button>
                <button class="btn-small" style="background:var(--primary); color:white; flex:1;" onclick="addMenu()">Simpan</button>
            </div>
        </div>
    </div>

    <script type="module" src="mitra-script.js"></script>

    <!-- === TOMBOL KHUSUS ADMIN (MODAL SUPER USER) === -->
    <div id="admin-floating-btn" style="display:none; position:fixed; bottom:20px; right:20px; z-index:9999;">
        <button id="btn-home-nav" onclick="goHome()" style="background:rgba(255,255,255,0.2); color:white; border:1px solid white; padding:5px 12px; border-radius:5px; cursor:pointer;">
    <i class="fa-solid fa-house"></i> Home
    </button>
    </div>

    <!-- SCRIPT KHUSUS LOGIKA ADMIN (TIMPA SCRIPT LAMA DI PALING BAWAH) -->
    <script>
        // Cek apakah user ini adalah Admin yang sedang menyamar?
        if (localStorage.getItem('adminOrigin') === 'true') {
            
            // 1. Tampilkan Tombol Floating "Kembali ke Admin"
            const floatBtn = document.getElementById('admin-floating-btn');
            if(floatBtn) floatBtn.style.display = 'block';

            // 2. PERBAIKAN TOMBOL HOME (Agar balik jadi Admin saat klik Home)
            const homeBtn = document.getElementById('btn-home-nav');
            if (homeBtn) {
                // Matikan fungsi goHome() bawaan mitra
                homeBtn.removeAttribute("onclick");
                
                // Pasang fungsi baru khusus Admin
                homeBtn.addEventListener('click', function() {
                    if(confirm("Kembali ke Home sebagai SUPER ADMIN?")) {
                        // KEMBALIKAN IDENTITAS ADMIN
                        localStorage.setItem('userRole', 'admin');
                        localStorage.setItem('userName', 'Super Admin');
                        // Hapus jejak penyamaran (Opsional, tapi sebaiknya jangan dihapus biar konsisten)
                        // localStorage.removeItem('adminOrigin'); 
                        
                        // Pindah ke Index
                        window.location.href = 'index.html';
                    }
                });
            }
        }

        // Fungsi untuk Tombol Floating (Balik ke Dashboard Admin)
        function backToAdminDashboard() {
            if(confirm("Kembali ke Control Tower Admin?")) {
                localStorage.setItem('userRole', 'admin');
                localStorage.setItem('userName', 'Super Admin');
                localStorage.setItem('userLink', 'admin-dashboard.html');
                window.location.href = 'admin-dashboard.html';
            }
        }
    </script>
</body>
</html>
