<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil Mentor Profesional - SMIPRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* === CSS TEMA ELEGAN (TIDAK BERUBAH) === */
        body { 
            background-color: #0a0a0a; 
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(255, 215, 0, 0.03), transparent 25%), 
                radial-gradient(circle at 85% 30%, rgba(229, 9, 20, 0.03), transparent 25%);
            color: #f0f0f0;
        }
        .profile-hero {
            height: 350px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2), #0a0a0a), url('https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?q=80&w=1200');
            background-size: cover; background-position: center;
            position: relative; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            padding-bottom: 60px; border-bottom: 1px solid #333;
        }
        .hero-logo { position: absolute; top: 20px; left: 20px; width: 60px; opacity: 0.8; filter: drop-shadow(0 0 10px rgba(0,0,0,0.8)); }
        .avatar-wrapper { position: relative; margin-bottom: 15px; }
        .profile-avatar-big {
            width: 140px; height: 140px; border-radius: 50%; object-fit: cover; border: 4px solid #1a1a1a;
            box-shadow: 0 0 0 4px #FFD700, 0 0 30px rgba(255, 215, 0, 0.4);
        }
        .verified-badge {
            position: absolute; bottom: 5px; right: 5px; background: #FFD700; color: #000;
            width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; border: 3px solid #1a1a1a; box-shadow: 0 5px 10px rgba(0,0,0,0.5);
        }
        .mentor-name { font-size: 2rem; font-weight: 800; margin: 0; text-shadow: 0 5px 15px rgba(0,0,0,0.8); letter-spacing: 1px; }
        .mentor-title { color: #FFD700; font-size: 1rem; margin-top: 5px; letter-spacing: 2px; text-transform: uppercase; font-weight: bold; }
        .content-container { max-width: 900px; margin: -40px auto 0; padding: 0 20px; position: relative; z-index: 10; }
        .credential-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px; }
        .elegance-card {
            background: rgba(30, 30, 30, 0.6); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); padding: 25px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); transition: 0.3s;
        }
        .elegance-card:hover { transform: translateY(-5px); border-color: #FFD700; box-shadow: 0 15px 40px rgba(255, 215, 0, 0.1); }
        .card-header { border-bottom: 1px solid rgba(255, 215, 0, 0.3); padding-bottom: 10px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .card-header h3 { margin: 0; font-size: 1.1rem; color: #fff; letter-spacing: 1px; text-transform: uppercase; }
        .card-header i { color: #FFD700; font-size: 1.2rem; }
        .golden-list { list-style: none; padding: 0; margin: 0; }
        .golden-list li { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 12px; color: #ccc; font-size: 0.95rem; line-height: 1.4; }
        .golden-list li i { color: #FFD700; margin-top: 4px; font-size: 0.8rem; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;}
        .gallery-item { position: relative; border-radius: 10px; overflow: hidden; aspect-ratio: 16/9; border: 1px solid #333; background: #000; cursor: pointer; }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .gallery-item:hover img { transform: scale(1.1); }
        .gallery-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; opacity: 0; transition: 0.3s; }
        .gallery-item:hover .gallery-overlay { opacity: 1; }
        .btn-wa {
            display: inline-flex; align-items: center; gap: 10px; background: linear-gradient(45deg, #b99205, #FFD700);
            color: black; font-weight: bold; border: none; padding: 12px 30px; border-radius: 30px;
            font-size: 1rem; cursor: pointer; margin-top: 30px; box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3); text-decoration: none; transition: 0.3s;
        }
        .btn-wa:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5); }

        /* CSS SOSMED MENTOR */
        .social-links { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; }
        .social-icon { 
        width: 40px; height: 40px; border-radius: 50%; background: #222; color: #ccc;
        display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        text-decoration: none; border: 1px solid #444; transition: 0.3s;
        }
        .social-icon:hover { background: #FFD700; color: black; border-color: #FFD700; transform: translateY(-3px); }
        @media (max-width: 768px) {
            .credential-grid { grid-template-columns: 1fr; }
            .profile-hero { height: 300px; padding-bottom: 40px; }
            .profile-avatar-big { width: 110px; height: 110px; }
            .mentor-name { font-size: 1.5rem; }
        }
        /* SMART FLOATING PLAYER (SPOTIFY STYLE) */
.floating-player {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: rgba(15, 15, 15, 0.98);
    backdrop-filter: blur(15px); border-top: 1px solid #333;
    padding: 12px 20px; display: none; z-index: 9998;
    animation: slideUp 0.5s ease;
}
.player-inner { max-width: 900px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 15px; }
.player-info { display: flex; align-items: center; gap: 12px; width: 35%; overflow: hidden; }
.mini-cover { width: 45px; height: 45px; border-radius: 4px; object-fit: cover; border: 1px solid #333; }
.mini-text { overflow: hidden; white-space: nowrap; }
.mini-title { font-size: 0.85rem; font-weight: bold; display: block; text-overflow: ellipsis; overflow: hidden; color: #fff; }
.mini-artist { font-size: 0.7rem; color: #888; }

.player-controls { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 5px; }
.ctrl-btns { display: flex; align-items: center; gap: 20px; }
.btn-play-main { background: #fff; color: #000; width: 38px; height: 38px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
.btn-sub { background: none; border: none; color: #666; cursor: pointer; font-size: 1rem; transition: 0.3s; }
.btn-sub.active { color: #1db954; }

.progress-box { width: 100%; display: flex; align-items: center; gap: 10px; font-size: 0.65rem; color: #666; }
.bar-bg { flex: 1; height: 4px; background: #333; border-radius: 2px; cursor: pointer; position: relative; }
.bar-fill { height: 100%; background: #1db954; width: 0%; border-radius: 2px; }

/* NAIKKAN FLOATING WA AGAR TIDAK TERTUTUP PLAYER */
.floating-wa { bottom: 95px !important; z-index: 9999; }

@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

@media (max-width: 600px) {
    .player-info { width: 55%; }
    .btn-sub:not(#btn-play-main) { font-size: 0.9rem; }
    .ctrl-btns { gap: 12px; }
}
    </style>
</head>
<body>

    <nav class="top-nav" style="position:fixed; background:rgba(0,0,0,0.8); backdrop-filter:blur(5px); width:100%; top:0; z-index:999; border:none;">
        <button onclick="location.href='training.html'" class="btn-back">
            <i class="fa-solid fa-arrow-left"></i> Kembali
        </button>
        <span style="font-weight:bold; color:#FFD700; letter-spacing:1px;">MENTOR PROFILE</span>
    </nav>

    <!-- HEADER & IDENTITAS -->
    <div class="profile-hero">
        <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/main/Logo_Stretart.png" class="hero-logo">
        <div class="avatar-wrapper">
            <img src="" id="m-img" class="profile-avatar-big" onerror="this.src='https://via.placeholder.com/150'">
            <div class="verified-badge"><i class="fa-solid fa-check"></i></div>
        </div>
        <h1 class="mentor-name" id="m-name">Memuat Data...</h1>
        <div class="mentor-title" id="m-specialist">-</div>
    </div>

    <div class="content-container">
        
        <div class="credential-grid">
            <!-- PORTOFOLIO -->
            <div class="elegance-card">
                <div class="card-header"><i class="fa-solid fa-briefcase"></i><h3>Track Record & Portofolio</h3></div>
                <ul class="golden-list" id="list-portfolio"><li><i class="fa-solid fa-spinner fa-spin"></i> Loading...</li></ul>
            </div>
            <!-- PROFESI -->
            <div class="elegance-card">
                <div class="card-header"><i class="fa-solid fa-id-card-clip"></i><h3>Status Profesi</h3></div>
                <ul class="golden-list" id="list-profession"><li><i class="fa-solid fa-spinner fa-spin"></i> Loading...</li></ul>
            </div>
        </div>

        <div class="section-title" style="border-color:#333; color:#fff;">
            <i class="fa-solid fa-photo-film" style="color:#FFD700;"></i> Showcase Karya
        </div>
        
        <div class="gallery-grid" id="gallery-container">
            <!-- Nanti diisi dinamis, sementara dummy untuk visual -->
            
        </div>
   
            <!-- FOOTER -->
<div class="footer-action">
    <p style="color:#888; font-size:0.9rem; margin-bottom:15px;">Ingin mengundang mentor ini untuk pelatihan?</p>
    
    <!-- WADAH SOSMED (JS AKAN MENGISI INI) -->
    <div id="social-container" class="social-links"></div> 
    
    <a href="#" id="btn-wa" class="btn-wa">
        <i class="fa-brands fa-whatsapp"></i> Hubungi Manajemen
    </a>
</div>           
    </div>

    <!-- MODAL PLAYER UNTUK PENGUNJUNG -->
<div id="public-player-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:5000; align-items:center; justify-content:center; flex-direction:column; padding:20px;">
    <button onclick="closePublicPlayer()" style="position:absolute; top:20px; right:20px; background:none; border:none; color:white; font-size:2rem; cursor:pointer;">&times;</button>
    <div id="public-player-content" style="width:100%; max-width:800px; text-align:center;"></div>
</div>

    <!-- SMART FLOATING PLAYER -->
<div class="floating-player" id="player-bar">
    <div class="player-inner">
        <div class="player-info">
            <img src="" id="track-cover" class="mini-cover" crossorigin="anonymous">
            <div class="mini-text">
                <span id="track-title" class="mini-title">-</span>
                <span id="track-artist" class="mini-artist">SMIPRO Performer</span>
            </div>
        </div>
        <div class="player-controls">
            <div class="ctrl-btns">
                <button class="btn-sub" onclick="toggleShuffle()" id="btn-shuffle"><i class="fa-solid fa-shuffle"></i></button>
                <button class="btn-sub" onclick="prevTrack()"><i class="fa-solid fa-backward-step"></i></button>
                <button class="btn-play-main" onclick="togglePlay()"><i class="fa-solid fa-play" id="main-play-icon"></i></button>
                <button class="btn-sub" onclick="nextTrack()"><i class="fa-solid fa-forward-step"></i></button>
                <button class="btn-sub" onclick="toggleRepeat()" id="btn-repeat"><i class="fa-solid fa-repeat"></i></button>
            </div>
            <div class="progress-box">
                <span id="curr-time">0:00</span>
                <div class="bar-bg"><div class="bar-fill" id="progress-fill"></div></div>
                <span id="total-time">0:00</span>
            </div>
        </div>
    </div>
</div>
<audio id="main-audio"></audio>

   <!-- SCRIPT FIREBASE CONNECTED (VERSI FIX & STABIL) -->
    <script type="module">
        import { db } from './firebase-config.js';
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- VARIABEL GLOBAL ---
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        
        // Variabel Player & Video
        let playlist = [];
        let currentIndex = -1;
        let isShuffle = false;
        let isRepeatOne = false;
        
        // Variabel Kunci untuk Video (Menggunakan logika Page Performer agar stabil)
        let activeVideoWrapper = null; 
        let activeVideoHTML = ''; 

        // Logo untuk Overlay
        const LOGO_TUNE = "https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/refs/heads/main/Play_SMIPRO_Tune.jpg";
        const LOGO_STAGE = "https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/refs/heads/main/Play_StreetArt_Stage.jpg";

        // --- 1. LOAD PROFIL MENTOR ---
        async function loadProfile() {
            if(!id) {
                document.querySelector('.profile-hero').innerHTML = "<h2 style='color:white; padding-top:100px;'>Mentor Tidak Ditemukan</h2>";
                return;
            }

            const docRef = doc(db, "mentors", id);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();

                // A. IDENTITAS
                document.getElementById('m-name').innerText = data.name;
                document.getElementById('m-specialist').innerText = data.specialist || "Mentor Profesional";
                if(data.img) document.getElementById('m-img').src = data.img;

                // B. PORTOFOLIO
                const listPort = document.getElementById('list-portfolio');
                listPort.innerHTML = "";
                if(data.portfolio && data.portfolio.length > 0) {
                    data.portfolio.forEach(item => {
                        if (item && item.trim() !== "") listPort.innerHTML += `<li><i class="fa-solid fa-circle-check"></i> ${item}</li>`;
                    });
                }
                if (listPort.innerHTML === "") listPort.innerHTML = "<li>-</li>";

                // C. PROFESI
                const listProf = document.getElementById('list-profession');
                listProf.innerHTML = "";
                if(data.profession && data.profession.length > 0) {
                    data.profession.forEach(item => {
                        if (item && item.trim() !== "") listProf.innerHTML += `<li><i class="fa-solid fa-user-tie"></i> ${item}</li>`;
                    });
                }          
                if (listProf.innerHTML === "") listProf.innerHTML = "<li>-</li>";

                // D. SOSMED
                const socialBox = document.getElementById('social-container');
                if (socialBox) {
                    socialBox.innerHTML = '';
                    if (data.socials) {
                        if(data.socials.ig) socialBox.innerHTML += `<a href="${data.socials.ig}" target="_blank" class="social-icon"><i class="fa-brands fa-instagram"></i></a>`;
                        if(data.socials.tiktok) socialBox.innerHTML += `<a href="${data.socials.tiktok}" target="_blank" class="social-icon"><i class="fa-brands fa-tiktok"></i></a>`;
                        if(data.socials.yt) socialBox.innerHTML += `<a href="${data.socials.yt}" target="_blank" class="social-icon"><i class="fa-brands fa-youtube"></i></a>`;
                        if(data.socials.fb) socialBox.innerHTML += `<a href="${data.socials.fb}" target="_blank" class="social-icon"><i class="fa-brands fa-facebook-f"></i></a>`;
                    }
                }

                // E. TOMBOL WA
                const text = `Halo Admin SMIPRO, saya tertarik dengan profil mentor *${data.name}* (${data.specialist}). Mohon info lebih lanjut.`;
                document.getElementById('btn-wa').href = `https://wa.me/6281234567890?text=${encodeURIComponent(text)}`;

                // F. PANGGIL FUNGSI SHOWCASE (Karya)
                if (data.gallery) {
                    renderSmartShowcase(data.gallery);
                }

            } else {
                document.querySelector('.content-container').innerHTML = "<center><h3 style='color:#ccc;'>Data Mentor Tidak Ditemukan di Database.</h3></center>";
            }
        }

        // --- 2. FUNGSI RENDER SHOWCASE (Dipisahkan agar rapi) ---
        function renderSmartShowcase(gallery) {
            const container = document.getElementById('gallery-container');
            if(!container) return;
            container.innerHTML = "";

            const videos = gallery.filter(i => i.type === 'video');
            playlist = gallery.filter(i => i.type === 'audio'); 

            // RENDER VIDEO
            if (videos.length > 0) {
                container.innerHTML += `<div class="section-divider">ðŸŽ¬ STREET STAGE</div><div class="gallery-grid video-aspect"></div>`;
                const vGrid = container.lastElementChild;
                videos.forEach((v, idx) => {
                    // Smart Youtube Link logic
                    let vId = "";
                    if (v.url.includes('v=')) vId = v.url.split('v=')[1].split('&')[0];
                    else if (v.url.includes('youtu.be/')) vId = v.url.split('youtu.be/')[1].split('?')[0];
                    else if (v.url.includes('embed/')) vId = v.url.split('embed/')[1].split('?')[0];

                    const thumb = vId ? `https://img.youtube.com/vi/${vId}/hqdefault.jpg` : (v.cover || "https://via.placeholder.com/300x168");
                    
                    vGrid.innerHTML += `
                    <div class="gallery-item" onclick="playInside('v-${idx}', 'video', '${v.url}')" id="v-${idx}">
                        <div class="thumb-wrap">
                            <img src="${thumb}" class="thumb-img">
                            <div class="play-overlay"><img src="${LOGO_STAGE}" style="width:50px;border-radius:50%;border:2px solid #fff;"></div>
                        </div>
                        <span class="item-title">${v.title}</span>
                    </div>`;
                });
            }

            // RENDER AUDIO
            if (playlist.length > 0) {
                container.innerHTML += `<div class="section-divider">ðŸŽ§ SMIPRO TUNES</div><div class="gallery-grid"></div>`;
                const aGrid = container.lastElementChild;
                
                playlist.forEach((track, index) => {
                    const fallbackImg = document.getElementById('m-img')?.src || "";
                    const cover = (track.cover && track.cover.length > 10) ? track.cover : fallbackImg;
                    playlist[index].cover = cover; // Update playlist data

                    aGrid.innerHTML += `
                    <div class="gallery-item" onclick="window.playTrack(${index})">
                        <div class="thumb-wrap">
                            <img src="${cover}" class="thumb-img">
                            <div class="play-overlay"><img src="${LOGO_TUNE}" style="width:50px;border-radius:50%;border:2px solid #fff;"></div>
                        </div>
                        <span class="item-title">${track.title}</span>
                    </div>`;
                });
            }
        }

        /* =========================================
           SISTEM PLAYER (DIADAPTASI DARI PAGE PERFORMER)
           ========================================= */

        // 1. FUNGSI PLAY VIDEO (DALAM KOTAK)
        window.playInside = function(elementId, type, url) {
            const box = document.getElementById(elementId);
            const audio = document.getElementById('main-audio');
            const playerBar = document.getElementById('player-bar');

            // Matikan Musik MP3 jika sedang jalan
            if(audio && !audio.paused) audio.pause();
            if(playerBar) playerBar.style.display = 'none';

            const targetWrapper = box.querySelector('.thumb-wrap');

            // Reset video lain yang sedang aktif (Kill Switch)
            if (activeVideoWrapper && activeVideoWrapper !== targetWrapper) {
                activeVideoWrapper.innerHTML = activeVideoHTML;
                const title = activeVideoWrapper.parentElement.querySelector('.item-title');
                if(title) title.style.display = 'block';
                activeVideoWrapper = null;
            }

            // Simpan HTML asli sebelum berubah jadi iframe
            if (activeVideoWrapper !== targetWrapper) {
                activeVideoHTML = targetWrapper.innerHTML;
                activeVideoWrapper = targetWrapper;
            }

            // Generate Embed URL
            let embedUrl = url;
            if(url.includes('v=')) embedUrl = `https://www.youtube.com/embed/${url.split('v=')[1].split('&')[0]}?autoplay=1`;
            else if(url.includes('youtu.be/')) embedUrl = `https://www.youtube.com/embed/${url.split('youtu.be/')[1].split('?')[0]}?autoplay=1`;
            else if(url.includes('embed/')) embedUrl = `${url}?autoplay=1`;

            // Masukkan Iframe
            targetWrapper.innerHTML = `<iframe width="100%" height="100%" src="${embedUrl}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen style="border-radius:10px;"></iframe>`;
            
            // Sembunyikan judul kecil (opsional)
            const title = box.querySelector('.item-title');
            if(title) title.style.display = 'none';

            box.scrollIntoView({ behavior: 'smooth', block: 'center' });
        };

        // 2. FUNGSI PLAY AUDIO (PLAYLIST MODE)
        window.playTrack = function(index) {
            // Matikan Video Youtube jika ada yang nyala
            if (activeVideoWrapper) {
                activeVideoWrapper.innerHTML = activeVideoHTML;
                const title = activeVideoWrapper.parentElement.querySelector('.item-title');
                if(title) title.style.display = 'block';
                activeVideoWrapper = null;
            }

            currentIndex = index;
            const track = playlist[index];
            const audio = document.getElementById('main-audio');
            const playerBar = document.getElementById('player-bar');

            if(audio && playerBar) {
                playerBar.style.display = 'block';
                document.getElementById('track-cover').src = track.cover;
                document.getElementById('track-title').innerText = track.title;
                
                audio.src = cleanLink(track.url);
                audio.load();
                audio.play().catch(e => console.log("Autoplay blocked"));
                
                updateBanner(track.cover);
            }
        };

        // 3. KONTROL PLAYER (Next, Prev, Shuffle)
        window.togglePlay = () => {
            const a = document.getElementById('main-audio');
            if(a.paused) a.play(); else a.pause();
        };

        window.nextTrack = () => {
            if(playlist.length === 0) return;
            currentIndex = isShuffle ? Math.floor(Math.random() * playlist.length) : (currentIndex + 1) % playlist.length;
            playTrack(currentIndex);
        };

        window.prevTrack = () => {
            if(playlist.length === 0) return;
            currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
            playTrack(currentIndex);
        };

        window.toggleShuffle = () => { 
            isShuffle = !isShuffle; 
            document.getElementById('btn-shuffle').classList.toggle('active', isShuffle); 
        };

        window.toggleRepeat = () => { 
            isRepeatOne = !isRepeatOne; 
            document.getElementById('btn-repeat').classList.toggle('active', isRepeatOne); 
        };

        // --- 4. EVENT LISTENER (INI YANG KURANG DI KODE ANDA) ---
        // Ini adalah "Mesin" yang membuat progress bar jalan dan ikon berubah
        
        const mainAudio = document.getElementById('main-audio');
        if(mainAudio) {
            // Ubah Icon Play/Pause saat status audio berubah
            mainAudio.onplay = () => {
                const icon = document.getElementById('main-play-icon');
                if(icon) { icon.classList.remove('fa-play'); icon.classList.add('fa-pause'); }
            };
            mainAudio.onpause = () => {
                const icon = document.getElementById('main-play-icon');
                if(icon) { icon.classList.remove('fa-pause'); icon.classList.add('fa-play'); }
            };
            
            // Auto Next saat lagu habis
            mainAudio.onended = () => { if(isRepeatOne) mainAudio.play(); else nextTrack(); };
            
            // Update Progress Bar (Spidometer)
            mainAudio.ontimeupdate = () => {
                const pct = (mainAudio.currentTime / mainAudio.duration) * 100;
                const fill = document.getElementById('progress-fill');
                if(fill) fill.style.width = pct + '%';
                
                document.getElementById('curr-time').innerText = formatTime(mainAudio.currentTime);
                if(!isNaN(mainAudio.duration)) document.getElementById('total-time').innerText = formatTime(mainAudio.duration);
            };
        }

        // Klik pada garis durasi untuk lompat lagu
        const progressBar = document.querySelector('.bar-bg');
        if(progressBar && mainAudio) {
            progressBar.addEventListener('click', (e) => {
                const width = progressBar.clientWidth;
                const clickX = e.offsetX;
                const duration = mainAudio.duration;
                if(duration) {
                    mainAudio.currentTime = (clickX / width) * duration;
                }
            });
        }

        // --- HELPER FUNCTIONS ---
        function cleanLink(u) {
            if(!u) return "";
            if(u.includes('dropbox.com')) return u.replace('www.dropbox.com', 'dl.dropboxusercontent.com').replace('dl=0', 'raw=1');
            if(u.includes('drive.google.com')) {
                const id = u.includes('/file/d/') ? u.split('/file/d/')[1].split('/')[0] : u.split('id=')[1]?.split('&')[0];
                return `https://drive.google.com/uc?export=download&id=${id}`;
            }
            return u;
        }

        function formatTime(s) {
            const m = Math.floor(s/60);
            const sec = Math.floor(s%60);
            return `${m}:${sec < 10 ? '0' : ''}${sec}`;
        }

        function updateBanner(imgSrc) {
            const hero = document.querySelector('.profile-hero');
            if(!hero || !imgSrc) return;
            hero.style.transition = "background 1.5s ease";
            hero.style.background = `linear-gradient(to bottom, rgba(0,0,0,0.3), #0a0a0a), url('${imgSrc}')`;
            hero.style.backgroundSize = "cover";
            hero.style.backgroundPosition = "center";
        }
        
        window.closePublicPlayer = function() {
            document.getElementById('public-player-modal').style.display = 'none';
            document.getElementById('public-player-content').innerHTML = ''; 
        }

        // Jalankan Script Utama
        loadProfile();

    </script>
</body>
</html>
