<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil Mentor Profesional - SMIPRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* === CSS TEMA ELEGAN (TIDAK BERUBAH) === */
        body { 
            background-color: #0a0a0a; 
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(255, 215, 0, 0.03), transparent 25%), 
                radial-gradient(circle at 85% 30%, rgba(229, 9, 20, 0.03), transparent 25%);
            color: #f0f0f0;
        }
        .profile-hero {
            height: 350px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2), #0a0a0a), url('https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?q=80&w=1200');
            background-size: cover; background-position: center;
            position: relative; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;
            padding-bottom: 60px; border-bottom: 1px solid #333;
        }
        .hero-logo { position: absolute; top: 20px; left: 20px; width: 60px; opacity: 0.8; filter: drop-shadow(0 0 10px rgba(0,0,0,0.8)); }
        .avatar-wrapper { position: relative; margin-bottom: 15px; }
        .profile-avatar-big {
            width: 140px; height: 140px; border-radius: 50%; object-fit: cover; border: 4px solid #1a1a1a;
            box-shadow: 0 0 0 4px #FFD700, 0 0 30px rgba(255, 215, 0, 0.4);
        }
        .verified-badge {
            position: absolute; bottom: 5px; right: 5px; background: #FFD700; color: #000;
            width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; border: 3px solid #1a1a1a; box-shadow: 0 5px 10px rgba(0,0,0,0.5);
        }
        .mentor-name { font-size: 2rem; font-weight: 800; margin: 0; text-shadow: 0 5px 15px rgba(0,0,0,0.8); letter-spacing: 1px; }
        .mentor-title { color: #FFD700; font-size: 1rem; margin-top: 5px; letter-spacing: 2px; text-transform: uppercase; font-weight: bold; }
        .content-container { max-width: 900px; margin: -40px auto 0; padding: 0 20px; position: relative; z-index: 10; }
        .credential-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px; }
        .elegance-card {
            background: rgba(30, 30, 30, 0.6); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); padding: 25px; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); transition: 0.3s;
        }
        .elegance-card:hover { transform: translateY(-5px); border-color: #FFD700; box-shadow: 0 15px 40px rgba(255, 215, 0, 0.1); }
        .card-header { border-bottom: 1px solid rgba(255, 215, 0, 0.3); padding-bottom: 10px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .card-header h3 { margin: 0; font-size: 1.1rem; color: #fff; letter-spacing: 1px; text-transform: uppercase; }
        .card-header i { color: #FFD700; font-size: 1.2rem; }
        .golden-list { list-style: none; padding: 0; margin: 0; }
        .golden-list li { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 12px; color: #ccc; font-size: 0.95rem; line-height: 1.4; }
        .golden-list li i { color: #FFD700; margin-top: 4px; font-size: 0.8rem; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;}
        .gallery-item { position: relative; border-radius: 10px; overflow: hidden; aspect-ratio: 16/9; border: 1px solid #333; background: #000; cursor: pointer; }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .gallery-item:hover img { transform: scale(1.1); }
        .gallery-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; opacity: 0; transition: 0.3s; }
        .gallery-item:hover .gallery-overlay { opacity: 1; }
        .btn-wa {
            display: inline-flex; align-items: center; gap: 10px; background: linear-gradient(45deg, #b99205, #FFD700);
            color: black; font-weight: bold; border: none; padding: 12px 30px; border-radius: 30px;
            font-size: 1rem; cursor: pointer; margin-top: 30px; box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3); text-decoration: none; transition: 0.3s;
        }
        .btn-wa:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5); }

        /* CSS SOSMED MENTOR */
        .social-links { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; }
        .social-icon { 
        width: 40px; height: 40px; border-radius: 50%; background: #222; color: #ccc;
        display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        text-decoration: none; border: 1px solid #444; transition: 0.3s;
        }
        .social-icon:hover { background: #FFD700; color: black; border-color: #FFD700; transform: translateY(-3px); }
        @media (max-width: 768px) {
            .credential-grid { grid-template-columns: 1fr; }
            .profile-hero { height: 300px; padding-bottom: 40px; }
            .profile-avatar-big { width: 110px; height: 110px; }
            .mentor-name { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <nav class="top-nav" style="position:fixed; background:rgba(0,0,0,0.8); backdrop-filter:blur(5px); width:100%; top:0; z-index:999; border:none;">
        <button onclick="location.href='training.html'" class="btn-back">
            <i class="fa-solid fa-arrow-left"></i> Kembali
        </button>
        <span style="font-weight:bold; color:#FFD700; letter-spacing:1px;">MENTOR PROFILE</span>
    </nav>

    <!-- HEADER & IDENTITAS -->
    <div class="profile-hero">
        <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/main/Logo_Stretart.png" class="hero-logo">
        <div class="avatar-wrapper">
            <img src="" id="m-img" class="profile-avatar-big" onerror="this.src='https://via.placeholder.com/150'">
            <div class="verified-badge"><i class="fa-solid fa-check"></i></div>
        </div>
        <h1 class="mentor-name" id="m-name">Memuat Data...</h1>
        <div class="mentor-title" id="m-specialist">-</div>
    </div>

    <div class="content-container">
        
        <div class="credential-grid">
            <!-- PORTOFOLIO -->
            <div class="elegance-card">
                <div class="card-header"><i class="fa-solid fa-briefcase"></i><h3>Track Record & Portofolio</h3></div>
                <ul class="golden-list" id="list-portfolio"><li><i class="fa-solid fa-spinner fa-spin"></i> Loading...</li></ul>
            </div>
            <!-- PROFESI -->
            <div class="elegance-card">
                <div class="card-header"><i class="fa-solid fa-id-card-clip"></i><h3>Status Profesi</h3></div>
                <ul class="golden-list" id="list-profession"><li><i class="fa-solid fa-spinner fa-spin"></i> Loading...</li></ul>
            </div>
        </div>

        <div class="section-title" style="border-color:#333; color:#fff;">
            <i class="fa-solid fa-photo-film" style="color:#FFD700;"></i> Showcase Karya
        </div>
        
        <div class="gallery-grid" id="gallery-container">
            <!-- Nanti diisi dinamis, sementara dummy untuk visual -->
            
        </div>
   
            <!-- FOOTER -->
<div class="footer-action">
    <p style="color:#888; font-size:0.9rem; margin-bottom:15px;">Ingin mengundang mentor ini untuk pelatihan?</p>
    
    <!-- WADAH SOSMED (JS AKAN MENGISI INI) -->
    <div id="social-container" class="social-links"></div> 
    
    <a href="#" id="btn-wa" class="btn-wa">
        <i class="fa-brands fa-whatsapp"></i> Hubungi Manajemen
    </a>
</div>           
    </div>

    <!-- MODAL PLAYER UNTUK PENGUNJUNG -->
<div id="public-player-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:5000; align-items:center; justify-content:center; flex-direction:column; padding:20px;">
    <button onclick="closePublicPlayer()" style="position:absolute; top:20px; right:20px; background:none; border:none; color:white; font-size:2rem; cursor:pointer;">&times;</button>
    <div id="public-player-content" style="width:100%; max-width:800px; text-align:center;"></div>
</div>

    <!-- SCRIPT FIREBASE CONNECTED -->
    <script type="module">
        import { db } from './firebase-config.js';
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        let activeBoxId = null;       
        let activeOriginalHTML = null; 

        const params = new URLSearchParams(window.location.search);
        const id = params.get('id'); // Ambil ID dari URL (contoh: ?id=1)

        async function loadProfile() {
            if(!id) {
                document.querySelector('.profile-hero').innerHTML = "<h2 style='color:white; padding-top:100px;'>Mentor Tidak Ditemukan</h2>";
                return;
            }

            // AMBIL DATA DARI FIREBASE
            const docRef = doc(db, "mentors", id);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();

                // 1. ISI IDENTITAS
                document.getElementById('m-name').innerText = data.name;
                document.getElementById('m-specialist').innerText = data.specialist;
                if(data.img) document.getElementById('m-img').src = data.img;

                // 2. ISI PORTOFOLIO (Hanya yang ada isinya)
                const listPort = document.getElementById('list-portfolio');
                listPort.innerHTML = "";
                if(data.portfolio && data.portfolio.length > 0) {
                data.portfolio.forEach(item => {
                // TAMBAHAN: Cek jika item tidak kosong
                if (item && item.trim() !== "") {
                listPort.innerHTML += `<li><i class="fa-solid fa-circle-check"></i> ${item}</li>`;
                    }
                 });
                }
                // Jika setelah diloop ternyata kosong semua
                if (listPort.innerHTML === "") listPort.innerHTML = "<li>-</li>";

               // 3. ISI PROFESI (Hanya yang ada isinya)
                const listProf = document.getElementById('list-profession');
                listProf.innerHTML = "";
                if(data.profession && data.profession.length > 0) {
                data.profession.forEach(item => {
                // TAMBAHAN: Cek jika item tidak kosong
                if (item && item.trim() !== "") {
                listProf.innerHTML += `<li><i class="fa-solid fa-user-tie"></i> ${item}</li>`;
                    }
                    });
                }
                if (listProf.innerHTML === "") listProf.innerHTML = "<li>-</li>";

                // --- 5. RENDER SHOWCASE TERPISAH (STREET STAGE & SMIPRO TUNES) ---
                const galleryContainer = document.getElementById('gallery-container');
                galleryContainer.innerHTML = "";
                galleryContainer.style.display = "block"; // Ubah jadi block agar seksi menumpuk

                const LOGO_TUNE = "https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/refs/heads/main/Play_SMIPRO_Tune.jpg";
                const LOGO_STAGE = "https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/refs/heads/main/Play_StreetArt_Stage.jpg";

                if (data.gallery && data.gallery.length > 0) {
                    const videoWorks = data.gallery.filter(i => i.type === 'video');
                    const audioWorks = data.gallery.filter(i => i.type === 'audio');

                    // A. SEKSI VIDEO (STREET STAGE)
                    if (videoWorks.length > 0) {
                        galleryContainer.innerHTML += `<div style="margin:20px 0 15px; color:#FFD700; font-weight:800; font-size:1.1rem; border-bottom:1px solid #333; padding-bottom:5px; letter-spacing:1px;">ðŸŽ¬ STREET STAGE</div>`;
                        const vGrid = document.createElement('div');
                        vGrid.className = "gallery-grid";
                        videoWorks.forEach((v, idx) => {
                            const vThumb = v.url.includes('embed/') ? `https://img.youtube.com/vi/${v.url.split('embed/')[1].split('?')[0]}/hqdefault.jpg` : (v.cover || "https://via.placeholder.com/400x225");
                            vGrid.innerHTML += `
                            <div class="gallery-item" onclick="playInside('media-v-${idx}', 'video', '${v.url}')" id="media-v-${idx}">
                                <img src="${vThumb}" style="width:100%; height:100%; object-fit:cover;">
                                <div class="gallery-overlay"><img src="${LOGO_STAGE}" style="width:50px; border-radius:50%; border:2px solid white;"></div>
                                <div style="position:absolute; bottom:0; width:100%; background:rgba(0,0,0,0.7); padding:5px; font-size:0.8rem; text-align:center;">${v.title}</div>
                            </div>`;
                        });
                        galleryContainer.appendChild(vGrid);
                    }

                    // B. SEKSI AUDIO (SMIPRO TUNES)
                    if (audioWorks.length > 0) {
                        galleryContainer.innerHTML += `<div style="margin:40px 0 15px; color:#00d2ff; font-weight:800; font-size:1.1rem; border-bottom:1px solid #333; padding-bottom:5px; letter-spacing:1px;">ðŸŽ§ SMIPRO TUNES</div>`;
                        const aGrid = document.createElement('div');
                        aGrid.className = "gallery-grid";
                        audioWorks.forEach((a, idx) => {
                            const aCover = a.cover || data.img || "https://via.placeholder.com/300?text=SMIPRO+Tune";
                            aGrid.innerHTML += `
                            <div class="gallery-item" style="aspect-ratio:1/1;" onclick="playInside('media-a-${idx}', 'audio', '${a.url}', '${aCover}')" id="media-a-${idx}">
                                <img src="${aCover}" crossorigin="anonymous" style="width:100%; height:100%; object-fit:cover;">
                                <div class="gallery-overlay"><img src="${LOGO_TUNE}" style="width:60px; border-radius:50%; border:2px solid white;"></div>
                                <div style="position:absolute; bottom:0; width:100%; background:rgba(0,0,0,0.8); padding:8px; font-size:0.85rem; text-align:center; font-weight:bold;">${a.title}</div>
                            </div>`;
                        });
                        galleryContainer.appendChild(aGrid);
                    }
                } else {
                    galleryContainer.innerHTML = '<p style="color:#666; text-align:center;">Mentor belum menambahkan karya.</p>';
                }


// --- FUNGSI PLAY DENGAN AUTO-STOP (KILL SWITCH) ---
window.playInside = function(elementId, type, url, coverUrl) {
    const box = document.getElementById(elementId);
    if (!box) return;

    // 1. Matikan Background Music (BGM) jika masih bunyi
    const bgm = document.getElementById('bgm-player');
    if (bgm) bgm.pause();

    // 2. AUTO-STOP: Jika ada media lain yang sedang jalan, kembalikan ke Thumbnail
    if (activeBoxId && activeBoxId !== elementId) {
        const oldBox = document.getElementById(activeBoxId);
        if (oldBox && activeOriginalHTML) {
            oldBox.innerHTML = activeOriginalHTML; // Kembalikan ke tampilan gambar
        }
    }

    // 3. Simpan tampilan asli (Thumbnail & Overlay) kotak ini sebelum berubah jadi player
    // Hanya simpan jika kotak ini belum dalam mode player
    if (activeBoxId !== elementId) {
        activeOriginalHTML = box.innerHTML;
        activeBoxId = elementId;
    }

    // --- LOGIKA PENYULAP LINK ---
    function clean(u) {
        if(u.includes('dropbox.com')) return u.replace('www.dropbox.com', 'dl.dropboxusercontent.com').replace('dl=0', 'raw=1');
        if(u.includes('drive.google.com')) {
            const id = u.includes('/file/d/') ? u.split('/file/d/')[1].split('/')[0] : u.split('id=')[1]?.split('&')[0];
            return `https://drive.google.com/uc?export=download&id=${id}`;
        }
        return u;
    }

    // 4. MULAI PUTAR MEDIA BARU
    if(type === 'video') {
        // Video YouTube
        box.innerHTML = `<iframe width="100%" height="100%" src="${url}?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen style="border-radius:10px;"></iframe>`;
    } else {
        // Audio MP3 (Efek Ganti Warna Header)
        if(coverUrl) {
            const hero = document.querySelector('.profile-hero');
            hero.style.transition = "background 1s ease";
            hero.style.background = `linear-gradient(to bottom, rgba(0,0,0,0.2), #0a0a0a), url('${coverUrl}')`;
            hero.style.backgroundSize = "cover";
            hero.style.backgroundPosition = "center";
        }
        
        box.innerHTML = `
            <div style="width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#111; border-radius:10px; border:1px solid #00d2ff;">
                <i class="fa-solid fa-compact-disc fa-spin" style="font-size:2.5rem; color:#00d2ff; margin-bottom:10px;"></i>
                <audio id="current-active-audio" controls autoplay src="${clean(url)}" style="width:90%; height:35px;"></audio>
            </div>`;
            
        // Pastikan suara MP3 lain di halaman yang sama berhenti (Double Check)
        document.querySelectorAll('audio').forEach(el => {
            if(el.id !== 'current-active-audio') el.pause();
        });
    }

    // Fokuskan layar ke media yang diputar
    box.scrollIntoView({ behavior: 'smooth', block: 'center' });
}
                
window.closePublicPlayer = function() {
    document.getElementById('public-player-modal').style.display = 'none';
    document.getElementById('public-player-content').innerHTML = ''; // Stop video/audio
}

                // --- 6. TAMPILKAN SOSMED (LOGIKA BARU) ---
                const socialBox = document.getElementById('social-container');
                if (socialBox) {
                    socialBox.innerHTML = ''; // Bersihkan dulu

                    if (data.socials) {
                        if(data.socials.ig) socialBox.innerHTML += `<a href="${data.socials.ig}" target="_blank" class="social-icon"><i class="fa-brands fa-instagram"></i></a>`;
                        if(data.socials.tiktok) socialBox.innerHTML += `<a href="${data.socials.tiktok}" target="_blank" class="social-icon"><i class="fa-brands fa-tiktok"></i></a>`;
                        if(data.socials.yt) socialBox.innerHTML += `<a href="${data.socials.yt}" target="_blank" class="social-icon"><i class="fa-brands fa-youtube"></i></a>`;
                        if(data.socials.fb) socialBox.innerHTML += `<a href="${data.socials.fb}" target="_blank" class="social-icon"><i class="fa-brands fa-facebook-f"></i></a>`;
                    }
                }
                
                // 4. SETUP TOMBOL WA
                const text = `Halo Admin SMIPRO, saya tertarik dengan profil mentor *${data.name}* (${data.specialist}). Mohon info lebih lanjut.`;
                document.getElementById('btn-wa').href = `https://wa.me/6281234567890?text=${encodeURIComponent(text)}`;

                // (Opsional) Load Galeri jika nanti ada di database
                // Saat ini masih menggunakan dummy HTML di atas
            } else {
                document.querySelector('.content-container').innerHTML = "<center><h3 style='color:#ccc;'>Data Mentor Tidak Ditemukan di Database.</h3></center>";
            }
        }

        loadProfile();
        
    </script>
</body>
</html>
