<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stadion Bayuangga - SMIPRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* LAYOUT SPLIT ATAS */
        .split-view { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media(min-width: 768px) { .split-view { grid-template-columns: 1.5fr 1fr; } }

        /* VIDEO PLAYER */
        .live-frame {
            position: relative; width: 100%; height: 350px;
            background: url('https://images.unsplash.com/photo-1501612780327-450456b106f8?q=80&w=600') center/cover;
            border-radius: 15px; border: 1px solid #333;
            display: flex; align-items: center; justify-content: center;
        }
        .play-btn-big { font-size: 4rem; color: rgba(255,255,255,0.9); }

        /* LIVE PANEL KANAN */
        .live-panel { background: #151515; border: 1px solid #333; border-radius: 15px; padding: 20px; display: flex; flex-direction: column; height: 350px; }
        .live-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .live-badge { background: red; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; animation: pulse 1s infinite; float: right; }
        .perf-item { display: flex; justify-content: space-between; align-items: center; background: #222; padding: 10px; margin-bottom: 5px; border-radius: 5px; }
        .perf-info-box { display: flex; gap: 10px; align-items: center; }
        .perf-img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }

        .rate-badge { 
            background: rgba(255, 215, 0, 0.1); border: 1px solid gold; color: gold; 
            padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 5px; 
        }
        .rate-badge:hover { background: gold; color: black; }
        .btn-req { width: 100%; background: #E50914; color: white; padding: 12px; border: none; border-radius: 5px; margin-top: auto; font-weight: bold; cursor: pointer; }
        
        /* Tombol Request Lagu (FIXED) */
        .btn-req { 
            width: 100%; 
            background: #E50914; 
            color: white; 
            padding: 12px; 
            border: none; 
            border-radius: 5px; 
            margin-top: auto; 
            font-weight: bold; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px;
        }
        .btn-req:hover { background: #b71c1c; }

        /* === STYLE WARUNG (MIRIP SS3) === */
        .section-title { color: #FFD700; margin: 40px 0 15px; font-size: 1.2rem; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        .warung-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .warung-card { background: #1a1a1a; border-radius: 10px; border: 1px solid #333; overflow: hidden; text-align: center; transition: 0.3s; }
        .warung-card:hover { transform: translateY(-5px); border-color: #555; }
        .warung-img { width: 100%; height: 100px; object-fit: cover; background: #333; }
        .warung-body { padding: 12px; }
        .warung-name { font-size: 1rem; font-weight: 800; color: white; margin-bottom: 5px; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .warung-stats { font-size: 0.8rem; margin-bottom: 10px; display: block; }
        
        /* Tombol Booking */
        .btn-book-ss3 { background: #E50914; color: white; border: none; padding: 8px 0; width: 100%; border-radius: 20px; font-weight: bold; cursor: pointer; }
        .btn-full-ss3 { background: #555; color: #aaa; border: none; padding: 8px 0; width: 100%; border-radius: 20px; font-weight: bold; cursor: not-allowed; }

        /* REVIEW BAWAH */
        .review-box { background: #1e1e1e; padding: 20px; border-radius: 15px; margin-top: 40px; border: 1px solid #333; display: flex; gap: 20px; flex-wrap: wrap; }
        .venue-photo-review { width: 100px; height: 100px; object-fit: cover; border-radius: 10px; border: 2px solid #555; }
        .review-content { flex: 1; }
        
         /* List Ulasan Baru */
        .user-reviews { margin-top: 15px; max-height: 200px; overflow-y: auto; }
        .review-item { background: #2a2a2a; padding: 10px; border-radius: 5px; margin-bottom: 5px; font-size: 0.9rem; border-left: 3px solid gold; }

        /* MODAL POPUP */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999;
            display: none; justify-content: center; align-items: center; padding: 20px;
        }
        .modal-box {
            background: #1e1e1e; width: 100%; max-width: 350px; padding: 25px; border-radius: 10px; border: 1px solid #444; position: relative;
        }
        /* Logo di dalam Modal */
        .modal-logo { width: 80px; display: block; margin: 0 auto 15px auto; filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5)); }
        
        .input-request { width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white; border-radius: 5px; margin-bottom: 10px; }
        .btn-small { border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .close-icon { position: absolute; top: 15px; right: 15px; color: #888; cursor: pointer; font-size: 1.2rem; }
         .stars-input i { color: #444; font-size: 1.5rem; cursor: pointer; margin: 0 2px; }
        .stars-input i.gold { color: gold; }
    </style>
</head>
<body>

    <nav class="top-nav">
        <!-- LOGO KECIL DI NAVIGASI (BARU) -->
        <a href="index.html" class="logo-container" style="display:flex; align-items:center; text-decoration:none; gap:10px;">
            <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/main/Logo_Stretart.png" style="width:35px; height:35px; border-radius:50%; border:2px solid #E50914;">
            <span style="font-weight:800; color:#E50914; font-size:1.1rem;">SMIPRO</span>
        </a>
        <button onclick="location.href='index.html'" class="btn-back"><i class="fa-solid fa-arrow-left"></i> Dashboard</button>
    </nav>

    <div class="container">
        
        <!-- BAGIAN ATAS: LIVE & REQUEST -->
        <div class="split-view">
            <div class="live-frame">
                <i class="fa-solid fa-circle-play play-btn-big"></i>
                <div style="position:absolute; bottom:15px; left:15px;">
                    <h3 style="margin:0; text-shadow:0 0 10px black;">Panggung Utama Live</h3>
                </div>
            </div>

            <div class="live-panel">
                <div style="margin-bottom:15px;">
                    <h3 style="margin:0; display:inline-block;">Live Now</h3>
                    <span class="live-badge">ON AIR</span>
                </div>
                <div class="perf-item">
                    <img src="https://images.unsplash.com/photo-1516280440614-6697288d5d38?q=80&w=100" class="perf-img">
                    <div><b>Rina Violin</b><br><small style="color:#aaa;">19.00 - 20.00</small></div>
                </div>
                 <!-- RATING DENGAN ANGKA -->
                    <div class="rate-badge" onclick="openRatePerformer('Rina Violin')">
                        <i class="fa-solid fa-star"></i> 4.9
                    </div>
                
                <div class="perf-item">
                    <img src="https://images.unsplash.com/photo-1570295999919-56ceb5ecca61?q=80&w=100" class="perf-img">
                    <div><b>Acoustic Boys</b><br><small style="color:#aaa;">20.00 - 21.00</small></div>
                </div>
                 <!-- RATING DENGAN ANGKA -->
                    <div class="rate-badge" onclick="openRatePerformer('Rina Violin')">
                        <i class="fa-solid fa-star"></i> 4.8
                    </div>
                
                <!-- TOMBOL REQUEST FIX -->
                <button class="btn-req" onclick="openRequestModal()">
                    <i class="fa-solid fa-music"></i> Request Lagu & Sawer
                </button>
            </div>
        </div>

        <hr style="border:0; border-top:1px dashed #444; margin:30px 0;">

        <!-- DAFTAR WARUNG -->
        <div class="section-title">PILIH WARUNG & BOOKING MEJA</div>
        <div id="warung-grid-ss3" class="warung-grid"></div>

        <!-- REVIEW -->
        <div class="review-box">
            <!-- Foto Lokasi -->
            <img src="https://images.unsplash.com/photo-1555529733-0e670560f7e1?q=80&w=200" class="venue-photo-review">
            
            <div class="review-content">
                <h3 style="margin:0;">Ulasan Tempat</h3>
                <!-- Akumulasi Rating -->
                <div style="color:gold; font-size:1.2rem; margin:5px 0;">
                    ★★★★☆ <span style="font-size:1rem; color:white; font-weight:bold;">4.8 / 5.0</span>
                </div>
                <p style="color:#aaa; font-size:0.9rem; margin-top:0;">Bagaimana fasilitas di Stadion Bayuangga?</p>
                
                <textarea id="venue-comment" class="input-dark" placeholder="Tulis pengalaman Anda..."></textarea>
                
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <!-- Input Bintang -->
                    <div class="stars-input" id="venue-stars">
                        <i class="fa-solid fa-star" onclick="rateStar('venue', 1)"></i>
                        <i class="fa-solid fa-star" onclick="rateStar('venue', 2)"></i>
                        <i class="fa-solid fa-star" onclick="rateStar('venue', 3)"></i>
                        <i class="fa-solid fa-star" onclick="rateStar('venue', 4)"></i>
                        <i class="fa-solid fa-star" onclick="rateStar('venue', 5)"></i>
                    </div>
                    <button class="btn-book-ss3" style="width:120px;" onclick="submitVenueRating()">Kirim</button>
                </div>

                <!-- Hasil Ulasan Muncul Disini -->
                <div id="venue-reviews-list" class="user-reviews"></div>
            </div>
        </div>

    </div>

    <!-- MODAL REQUEST -->
    <div id="request-modal" class="modal-overlay">
        <div class="modal-box">
            <i class="fa-solid fa-xmark close-icon" onclick="closeModal('request-modal')"></i>
            <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/main/Logo_Stretart.png" class="modal-logo">
            
            <h3 style="margin:0; color:#E50914;">Request Lagu</h3>
            
            <select id="req-target" class="input-request">
                <option>Rina Violin</option>
                <option>Acoustic Boys</option>
            </select>
            <input type="text" id="req-song" class="input-request" placeholder="Judul Lagu">
            <input type="text" id="req-msg" class="input-request" placeholder="Ucapan / Salam">
            <input type="number" id="req-amount" class="input-request" placeholder="Nominal Sawer (Rp)">
            
             <div style="text-align:center; background:white; padding:10px; border-radius:10px; margin-bottom:10px;">
                <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/refs/heads/main/qris.png" style="width:100%;">
               <a href="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/refs/heads/main/qris.png" download="QRIS_SMIPRO" class="btn-book-ss3" style="background:#333; display:inline-block; padding:8px 15px; margin-top:5px; font-size:0.8rem; text-decoration:none;">
                    <i class="fa-solid fa-download"></i> Simpan Gambar QRIS
                </a>
            </div>
            <input type="text" id="req-sender" class="input-dark" placeholder="Nama Pemilik Rekening (Wajib)" style="border:1px solid #E50914;">

            <button class="btn-book-ss3" onclick="sendRequest()">SAYA SUDAH TRANSFER</button>
        </div>
    </div>


    <!-- MODAL BOOKING (DENGAN LOGO) -->
    <div id="booking-modal" class="modal-overlay">
        <div class="modal-box">
            <i class="fa-solid fa-xmark close-icon" onclick="closeModal('booking-modal')"></i>
            
            <!-- LOGO SMIPRO -->
            <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/main/Logo_Stretart.png" class="modal-logo" alt="Logo SMIPRO">
            
            <h3 style="margin:0; text-align:center;">Booking Meja</h3>
            <p id="modal-warung-name" style="text-align:center; color:#FFD700; margin-bottom:15px; font-weight:bold;">Nama Warung</p>
            
            <label style="color:#aaa; font-size:0.8rem;">Jam Booking</label>
            <input type="text" id="book-time" class="input-request" readonly style="background:#333; color:#888;">

            <input type="text" id="book-name" class="input-request" placeholder="Nama Pemesan">
            <input type="number" id="book-wa" class="input-request" placeholder="Nomor WhatsApp">
            <input type="number" id="book-pax" class="input-request" placeholder="Jumlah Orang" oninput="hitungMeja()">
            
            <label style="color:#aaa; font-size:0.8rem;">Kebutuhan Meja</label>
            <input type="text" id="book-qty" class="input-request" readonly style="color:#E50914; font-weight:bold; background:#333;" value="0 Meja">

            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn-small" style="background:#444; color:white; flex:1;" onclick="closeModal('booking-modal')">Batal</button>
                <button class="btn-small" style="background:var(--green); color:black; flex:1;" onclick="confirmBooking()">Booking</button>
            </div>
        </div>
    </div>

    <!-- SCRIPT (Disatukan agar pasti jalan) -->
    <script>
         <script type="module">
        import { db } from './firebase-config.js';
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const warungs = [
            { id: 1, name: "Warung Bu Sri", total: 15, available: 10, img: "https://images.unsplash.com/photo-1541544744-5e3a01998cd1?q=80&w=300" },
            { id: 2, name: "Kopi Pakde Jono", total: 10, available: 8, img: "https://images.unsplash.com/photo-1497935586351-b67a49e012bf?q=80&w=300" },
            { id: 3, name: "Angkringan Mas Boy", total: 20, available: 2, img: "https://images.unsplash.com/photo-1514933651103-005eec06c04b?q=80&w=300" },
            { id: 4, name: "Sate Taichan Pro", total: 12, available: 0, img: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?q=80&w=300" },
            { id: 5, name: "Ropang Gaul", total: 15, available: 15, img: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?q=80&w=300" }
        ];

        // RENDER WARUNG
        const container = document.getElementById('warung-grid-ss3');
        if(container) {
            warungs.forEach(w => {
                const isFull = w.available === 0;
                const statusColor = isFull ? 'red' : '#00ff00';
                const statusText = isFull ? '0 / ' + w.total + ' Meja' : w.available + ' / ' + w.total + ' Meja';

                let buttonHtml = isFull ? 
                    `<button class="btn-full-ss3">Penuh</button>` : 
                    `<button class="btn-book-ss3" onclick="openBooking(${w.id}, '${w.name}')">Booking</button>`;

                container.innerHTML += `
                <div class="warung-card">
                    <img src="${w.img}" class="warung-img">
                    <div class="warung-body">
                        <span class="warung-name">${w.name}</span>
                        <span class="warung-stats" style="color:${statusColor}">${statusText}</span>
                        ${buttonHtml}
                    </div>
                </div>`;
            });
        }

        // FUNGSI MODAL (WAJIB JALAN)
        function openRequestModal() {
            document.getElementById('request-modal').style.display = 'flex';
        }

        function sendRequest() {
            alert("Request Terkirim! Admin akan memverifikasi.");
            closeModal('request-modal');
        }

        function openBooking(id, name) {
            document.getElementById('modal-warung-name').innerText = name;
            const now = new Date();
            document.getElementById('book-time').value = String(now.getHours()).padStart(2,'0') + ":" + String(now.getMinutes()).padStart(2,'0') + " WIB";
            document.getElementById('booking-modal').style.display = 'flex';
        }

        function hitungMeja() {
            let orang = parseInt(document.getElementById('book-pax').value) || 0;
            let qty = orang > 0 ? Math.ceil(orang/4) : 0;
            document.getElementById('book-qty').value = qty + " Meja";
        }

        function confirmBooking() {
            const name = document.getElementById('book-name').value;
            const wa = document.getElementById('book-wa').value;
            const qty = parseInt(document.getElementById('book-qty').value);

            if(!name || !wa || !qty) return alert("Lengkapi data!");

            const kode = 'TIKET-' + Math.floor(1000 + Math.random() * 9000);
            closeModal('booking-modal');
            
            if(confirm(`Booking Berhasil!\nKode: ${kode}\n\nKirim tiket ke WhatsApp?`)) {
                window.open(`https://wa.me/${wa}?text=Halo ${name}, Kode Booking Anda: ${kode}`, '_blank');
            }
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    </script>
</body>
</html>
