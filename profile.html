<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil Performer - SMIPRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <!-- CSS KHUSUS HALAMAN INI -->
    <style>
        /* CONTAINER BANNER */
        .profile-banner {
            height: 250px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), #121212), url('https://images.unsplash.com/photo-1501612780327-450456b106f8?q=80&w=1000');
            background-size: cover;
            background-position: center;
            position: relative; 
            margin-bottom: 80px; 
        }

        /* LOGO KECIL */
        .profile-logo-corner {
            position: absolute; top: 20px; left: 20px;
            width: 60px !important; height: 60px !important;
            object-fit: contain; z-index: 20;
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.8));
        }

        /* FOTO PROFIL TENGAH */
        .profile-avatar-container {
            position: absolute; bottom: -60px; left: 50%;
            transform: translateX(-50%);
            width: 140px; height: 140px; z-index: 20;
            border-radius: 50%; background: #121212; padding: 5px;
        }

        .profile-avatar {
            width: 100%; height: 100%;
            border-radius: 50%; object-fit: cover;
            border: 3px solid #FFD700; 
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }

        .profile-identity { text-align: center; margin-bottom: 20px; }
        .rating-stars { color: gold; font-size: 1.2rem; margin: 5px 0; }
        .badge-lulus { 
            background: #1a3320; color: #4ade80; 
            padding: 5px 15px; border-radius: 20px; 
            font-size: 0.8rem; display: inline-flex; 
            align-items: center; gap: 5px; 
            border: 1px solid #4ade80; margin-top: 5px;
        }
        .bio-box { background: #1e1e1e; padding: 20px; border-radius: 12px; border: 1px solid #333; text-align: center; margin-bottom: 30px; }
        .bio-socials { display: flex; justify-content: center; gap: 20px; margin-top: 15px; border-top: 1px dashed #444; padding-top: 15px; }
        .bio-socials a { font-size: 1.5rem; color: white; cursor: pointer; transition: 0.3s; }
        .bio-socials a:hover { transform: scale(1.2); }
        
        /* Floating WA */
        .floating-wa { position: fixed; bottom: 25px; right: 25px; background: #25D366; color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: 0 5px 15px rgba(0,0,0,0.5); z-index: 100; text-decoration: none; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <!-- NAVBAR -->
    <nav class="top-nav" style="position:fixed; background:rgba(0,0,0,0.8); width:100%; top:0; z-index:999; border:none;">
        <button onclick="location.href='index.html'" class="btn-back">
            <i class="fa-solid fa-arrow-left"></i> Kembali
        </button>
        <span style="font-weight:bold;">Profil Musisi</span>
    </nav>

    <!-- HEADER BANNER -->
    <div class="profile-banner">
        <img src="https://raw.githubusercontent.com/sekolakonangindonesia-prog/smipro-streetart/main/Logo_Stretart.png" class="profile-logo-corner" alt="Logo">
        <div class="profile-avatar-container">
            <img src="" id="p-img" class="profile-avatar" onerror="this.src='https://via.placeholder.com/150'">
        </div>
    </div>

    <div class="container">
        
        <!-- IDENTITAS -->
        <div class="profile-identity">
            <h1 id="p-name" style="margin:0; color:white;">Memuat...</h1>
            <p id="p-genre" style="color:#FFD700; margin:5px 0;">-</p>
            <div class="rating-stars">
                <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                <span id="p-rating" style="color:white; font-size:1rem; margin-left:5px;">5.0</span>
            </div>
            <div class="badge-lulus">
                <i class="fa-solid fa-circle-check"></i> LULUS PELATIHAN ATTITUDE
            </div>
        </div>

        <!-- BIO & SOSMED -->
        <div class="bio-box">
            <h4 style="margin-top:0; color:white;">Tentang Musisi</h4>
            <p id="p-bio" style="color:#aaa; font-size:0.9rem; line-height:1.6;">
                -
            </p>
            <div class="bio-socials" id="social-links">
                <!-- Ikon Sosmed akan muncul disini jika ada linknya -->
            </div>
        </div>

        <!-- JADWAL TAMPIL (OTOMATIS DARI DATABASE EVENT) -->
        <div class="section-title"><i class="fa-regular fa-calendar-check"></i> Jadwal Mendatang</div>
        <div id="schedule-list" class="schedule-list">
            <p style="text-align:center; color:#555;">Mengecek jadwal...</p>
        </div>

        <!-- GALERI KARYA -->
        <div class="section-title"><i class="fa-solid fa-photo-film"></i> Galeri Karya</div>
        <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap:15px;">
            <div style="background:#181818; padding:10px; border-radius:8px;">
                <img src="https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=200" style="width:100%; border-radius:5px;">
                <span style="color:white; display:block; margin-top:5px; font-weight:bold; font-size:0.8rem;">Live Performance</span>
            </div>
            <div style="background:#181818; padding:10px; border-radius:8px;">
                <img src="https://images.unsplash.com/photo-1493225255756-d9584f8606e9?q=80&w=200" style="width:100%; border-radius:5px;">
                <span style="color:white; display:block; margin-top:5px; font-weight:bold; font-size:0.8rem;">Cover Lagu Hits</span>
            </div>
        </div>

        <br><br><br>
    </div>

    <!-- FLOATING WA -->
    <a href="#" id="wa-link" class="floating-wa" target="_blank">
        <i class="fa-brands fa-whatsapp"></i>
    </a>

    <!-- SCRIPT FIREBASE -->
    <script type="module">
        import { db } from './firebase-config.js';
        import { doc, getDoc, collection, query, where, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');

        async function loadProfile() {
            if(!id) {
                document.querySelector('.container').innerHTML = "<h3 style='text-align:center; margin-top:50px;'>Data tidak ditemukan.</h3>";
                return;
            }

            // 1. AMBIL DATA PERFORMER
            const docRef = doc(db, "performers", id);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                const artistName = data.name;

                // Tampilkan Data Utama
                document.getElementById('p-name').innerText = data.name;
                document.getElementById('p-genre').innerText = data.genre;
                document.getElementById('p-rating').innerText = data.rating || "5.0";
                document.getElementById('p-bio').innerText = data.bio || "Belum ada bio.";
                
                if(data.img) document.getElementById('p-img').src = data.img;

                // Tampilkan Sosmed (Hanya jika ada link)
                const socialContainer = document.getElementById('social-links');
                socialContainer.innerHTML = '';
                
                if(data.link_ig) socialContainer.innerHTML += `<a href="${data.link_ig}" target="_blank"><i class="fa-brands fa-instagram" style="color:#C13584;"></i></a>`;
                if(data.link_tiktok) socialContainer.innerHTML += `<a href="${data.link_tiktok}" target="_blank"><i class="fa-brands fa-tiktok" style="color:#00f2ea;"></i></a>`;
                if(data.link_yt) socialContainer.innerHTML += `<a href="${data.link_yt}" target="_blank"><i class="fa-brands fa-youtube" style="color:#ff0000;"></i></a>`;

                // Setup WA Link
                const textWA = `Halo Admin SMIPRO, saya ingin info booking talent *${data.name}*.`;
                document.getElementById('wa-link').href = `https://wa.me/6281234567890?text=${encodeURIComponent(textWA)}`;

                // 2. CARI JADWAL DI DATABASE EVENT
                loadArtistSchedule(artistName);

            } else {
                document.querySelector('.container').innerHTML = "<h3 style='text-align:center; margin-top:50px;'>Artis tidak ditemukan di database.</h3>";
            }
        }

        // FUNGSI PENCARI JADWAL OTOMATIS
        async function loadArtistSchedule(artistName) {
            const container = document.getElementById('schedule-list');
            container.innerHTML = '';

            // Ambil semua event yang akan datang
            const q = query(collection(db, "events"), orderBy("date", "asc"));
            const querySnapshot = await getDocs(q);
            
            let found = false;

            querySnapshot.forEach((doc) => {
                const event = doc.data();
                
                // Cek di dalam array performers event tersebut
                if(event.performers && Array.isArray(event.performers)) {
                    // Cari apakah nama artis ini ada di list performers event ini?
                    const mySession = event.performers.find(p => p.name === artistName);
                    
                    if(mySession) {
                        found = true;
                        container.innerHTML += `
                        <div style="background:#222; padding:15px; border-radius:10px; display:flex; align-items:center; gap:15px; border-left:5px solid #E50914; margin-bottom:10px;">
                            <div style="font-size:1.5rem; width:40px; text-align:center; color:#E50914;">
                                <i class="fa-solid fa-microphone-lines"></i>
                            </div>
                            <div>
                                <b style="color:white;">SMIPRO Live Stage</b><br>
                                <small style="color:#ccc;">${event.displayDate} @ ${event.location}</small><br>
                                <span style="color:#E50914; font-size:0.9rem; font-weight:bold;">Jam Tampil: ${mySession.time}</span>
                            </div>
                        </div>`;
                    }
                }
            });

            if(!found) {
                container.innerHTML = `<p style="text-align:center; color:#666; font-style:italic;">Belum ada jadwal tampil terdekat.</p>`;
            }
        }

        loadProfile();
    </script>

</body>
</html>
